<!DOCTYPE html>
<html lang="zh-CN">
<head>
 <meta charset="UTF-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1.0" />
 <title>My Game (Desktop)</title>

 <style>
   /* æ ·å¼éƒ¨åˆ†ä¿æŒä¸å˜ */
   :root{
     --c1:#0099FF;
     --c2:#00CCCC;
     --c3:#66CCFF;
     --c4:#00CC99;
     --c5:#FFFFFF;
     --c6:#0033CC;
     --c7:#33FFFF;
     --c8:#66FFFF;
   }

   *{margin:0;padding:0;box-sizing:border-box;font-family:'Microsoft YaHei','Segoe UI',sans-serif;}
   body{
     background:url(https://s3.imagency.cn/e/a4408a4743196953e13354223900f56e.png') no-repeat center center fixed;
     background-size:cover;
     color:var(--c5);
     min-height:100vh;
     padding:20px;
     position:relative;
     overflow-x:hidden;
   }
   body::before{
     content:'';
     position:fixed;top:0;left:0;width:100%;height:100%;
     background:rgba(255,255,255,0.15);
     z-index:-1;
   }

   .snowflake{position:fixed;background-color:rgba(0,153,255,0.35);border-radius:50%;pointer-events:none;z-index:1;}
   .container{max-width:1200px;margin:0 auto;padding:20px;position:relative;z-index:2;}

   header{
     text-align:center;margin-bottom:40px;padding:30px;
     background:rgba(255,255,255,0.25);
     border-radius:20px;
     box-shadow:0 16px 40px rgba(0,51,204,0.15);
     backdrop-filter:blur(10px);
     border:1px solid rgba(0,153,255,0.3);
     position:relative;overflow:hidden;
   }

   header::before{
     content:'';
     position:absolute;top:0;left:0;width:100%;height:5px;
     background:linear-gradient(90deg, rgba(0,153,255,0.95), rgba(0,204,204,0.95), rgba(0,153,255,0.95));
     background-size:200% 100%;
     animation:blueflow 3.2s linear infinite;
   }
   @keyframes blueflow{0%{background-position:0% 50%;}100%{background-position:200% 50%;}}

   h1{
     font-size:3.5rem;margin-bottom:10px;
     color:var(--c1);
     text-shadow:0 6px 18px rgba(0,51,204,0.25);
     font-weight:900;
   }

   .luotianyi-quote{
     font-size:1.4rem;
     color: rgba(255,255,255,0.95);
     font-style:italic;
     margin-top:15px;
     padding:10px 14px;
     border-radius:12px;
     background: rgba(0,153,255,0.2);
     display:inline-block;
     animation:float 3s ease-in-out infinite;
     border:none;
     text-shadow: 0 8px 18px rgba(0,51,204,0.25);
   }
   @keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-10px);} }

   .game-selector{display:flex;justify-content:center;gap:40px;margin-bottom:40px;flex-wrap:wrap;}
   .game-btn{
     background:linear-gradient(145deg,rgba(0,153,255,0.95),rgba(0,204,204,0.85));
     color:var(--c5);
     border:none;
     padding:25px 40px;font-size:1.6rem;border-radius:15px;cursor:pointer;
     transition:all .3s ease;
     box-shadow:0 14px 34px rgba(0,51,204,0.2);
     min-width:220px;
     backdrop-filter:blur(10px);
     border:2px solid rgba(255,255,255,0.3);
     position:relative;overflow:hidden;
     font-weight:900;
   }
   .game-btn::before{
     content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;
     background:linear-gradient(90deg,transparent,rgba(255,255,255,0.35),transparent);
     transition:.5s;
   }
   .game-btn:hover::before{left:100%;}
   .game-btn:hover{transform:translateY(-8px) scale(1.05);box-shadow:0 18px 40px rgba(0,51,204,0.25);}
   .game-btn:active{transform:translateY(-2px);}
   .game-icon{font-size:2.5rem;margin-bottom:10px;color:var(--c7);}

   .game-container{
     display:none;
     background:rgba(255,255,255,0.2);
     border-radius:20px;padding:30px;
     box-shadow:0 12px 36px rgba(0,51,204,0.2);
     margin-top:20px;
     backdrop-filter:blur(15px);
     border:1px solid rgba(255,255,255,0.3);
     position:relative;overflow:hidden;
   }
   .game-container::before{
     content:'';
     position:absolute;top:0;left:0;width:100%;height:5px;
     background:linear-gradient(90deg, rgba(0,153,255,0.95), rgba(0,204,204,0.95), rgba(0,153,255,0.65));
   }

   .game-title{
     text-align:center;font-size:2.5rem;margin-bottom:25px;
     color: rgba(255,255,255,0.95);
     position:relative;display:inline-block;left:50%;transform:translateX(-50%);
     background: transparent;
     padding: 0;
     border: none;
     font-weight:900;
     text-shadow: 0 10px 24px rgba(0,51,204,0.3);
   }
   .game-title::after{
     content:'';
     position:absolute;
     bottom:-10px;left:0;width:100%;height:3px;
     background:linear-gradient(90deg,transparent,rgba(0,153,255,0.90),transparent);
   }

   .rules-modal-overlay,
   .result-modal-overlay{
     display:none;position:fixed;top:0;left:0;width:100%;height:100%;
     background:rgba(0,51,204,0.6);
     z-index:1000;justify-content:center;align-items:center;animation:fadeIn .3s ease-out;
   }
   .result-modal-overlay{z-index:1001;}

   .rules-modal-content,
   .result-modal-content{
     background:rgba(255,255,255,0.98);
     padding:40px;border-radius:20px;width:90%;max-width:720px;text-align:center;
     box-shadow:0 24px 60px rgba(0,51,204,0.25);
     border:2px solid rgba(0,153,255,0.4);
     animation:modalAppear .5s ease-out;
     backdrop-filter:blur(20px);
     max-height:80vh;overflow-y:auto;position:relative;
     color:var(--c6);
   }
   .rules-modal-content::before{content:'â™ª';position:absolute;top:20px;right:20px;font-size:2rem;color:rgba(0,153,255,0.45);}
   .rules-title{font-size:2.2rem;margin-bottom:25px;color:var(--c6);font-weight:900;}
   .rules-text{line-height:1.7;font-size:1.2rem;text-align:left;margin-bottom:30px;padding:0 15px;color:var(--c6);}
   .rules-text p{margin-bottom:12px;padding-left:10px;border-left:3px solid var(--c1);color:var(--c6);}
   .rules-countdown{font-size:1.6rem;margin:25px 0;color:var(--c6);font-weight:900;}
   .rules-close-btn{
     background:linear-gradient(145deg,var(--c1),var(--c6));
     color:var(--c5);border:none;padding:12px 35px;border-radius:10px;
     cursor:pointer;font-size:1.2rem;transition:all .3s ease;
     box-shadow:0 8px 20px rgba(0,51,204,0.15);
     border:1px solid rgba(255,255,255,0.4);
     font-weight:900;
   }
   .rules-close-btn:hover{transform:scale(1.05);box-shadow:0 10px 26px rgba(0,51,204,0.2);}

   @keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
   @keyframes modalAppear{from{opacity:0;transform:scale(.8) translateY(-50px);}to{opacity:1;transform:scale(1) translateY(0);} }

   .game-area{display:flex;flex-direction:column;gap:30px;}

   .player-section{
     background: rgba(255,255,255,0.2);
     padding:25px;border-radius:15px;
     box-shadow:0 14px 30px rgba(0,51,204,0.15);
     backdrop-filter:blur(10px);
     border:1px solid rgba(0,153,255,0.3);
     color: rgba(255,255,255,0.95);
   }

   .section-title{
     font-size:1.6rem;margin-bottom:15px;
     color: rgba(255,255,255,0.95);
     border-bottom:2px solid rgba(0,153,255,0.4);
     padding-bottom:8px;
     font-weight:900;
     text-shadow: 0 10px 20px rgba(0,51,204,0.3);
   }

   .numbers-container{display:flex;justify-content:center;gap:30px;margin-bottom:20px;flex-wrap:wrap;}

   .number-item{
     background: linear-gradient(145deg, rgba(0,153,255,0.6), rgba(255,255,255,0.2));
     width:110px;height:110px;border-radius:50%;
     display:flex;align-items:center;justify-content:center;
     font-size:2.8rem;font-weight:900;
     box-shadow:0 16px 30px rgba(0,51,204,0.15);
     transition:all .3s ease;
     border:2px solid rgba(0,153,255,0.3);
     color: rgba(255,255,255,0.95);
     user-select:none;
   }
   .number-item:hover{transform:translateY(-4px) scale(1.02);}
   .dead{opacity:.55;background:linear-gradient(145deg,rgba(0,153,255,0.3),rgba(255,255,255,0.1));color:rgba(255,255,255,0.5);}
   .active{border:3px solid var(--c7);}

   .opbar{
     width:100%;
     display:flex;
     align-items:center;
     justify-content:center;
     gap:12px;
     margin-top:8px;
     padding:14px 16px;
     border-radius:12px;
     background: rgba(255,255,255,0.2);
     border:1px solid rgba(0,153,255,0.3);
     backdrop-filter:blur(10px);
     flex-wrap:wrap;
   }

   .control-btn{
     background:linear-gradient(145deg,rgba(0,153,255,0.98),rgba(0,51,204,0.98));
     color:var(--c5);
     border:none;
     padding:12px 26px;border-radius:10px;cursor:pointer;font-size:1.2rem;
     transition:all .3s ease;
     border:1px solid rgba(255,255,255,0.5);
     box-shadow:0 10px 22px rgba(0,51,204,0.15);
     font-weight:900;
   }
   .control-btn:hover{transform:scale(1.05);box-shadow:0 12px 26px rgba(0,51,204,0.2);}
   .control-btn:disabled{
     background:rgba(0,153,255,0.4);
     color:rgba(255,255,255,0.6);
     cursor:not-allowed;transform:none;box-shadow:none;
     border:1px solid rgba(0,153,255,0.2);
   }
   .control-btn-secondary{
     background:linear-gradient(145deg,rgba(0,153,255,0.85),rgba(0,204,204,0.85));
     color: rgba(255,255,255,0.95);
     border:1px solid rgba(255,255,255,0.3);
     font-weight:900;
   }

   .console{
     background: rgba(255,255,255,0.2);
     padding:20px;border-radius:15px;margin-top:30px;min-height:120px;
     font-family:'Courier New', monospace;
     white-space:pre-wrap;overflow-y:auto;max-height:240px;
     border:1px solid rgba(0,153,255,0.3);
     color: rgba(255,255,255,0.95);
     box-shadow:0 14px 30px rgba(0,51,204,0.15);
   }
   .console-title{margin-bottom:10px;font-size:1.2rem;font-weight:900;color: rgba(255,255,255,0.95);}

   .move-counter{
     text-align:right;font-size:1.3rem;margin-bottom:15px;
     color: rgba(255,255,255,0.95);
     background: rgba(255,255,255,0.25);
     padding:10px 20px;border-radius:10px;display:inline-block;
     position:relative;left:auto;right:0;transform:none;float:right;
     border:1px solid rgba(0,153,255,0.3);
     font-weight:900;
     box-shadow:0 12px 26px rgba(0,51,204,0.2);
     margin-right:20px;
   }

   .result-icon{font-size:5rem;margin-bottom:20px;animation:bounce 1s infinite alternate;color:var(--c2);}
   @keyframes bounce{from{transform:translateY(0);}to{transform:translateY(-20px);} }
   .result-title{font-size:2.8rem;margin-bottom:16px;color:var(--c6);font-weight:900;}
   .result-message{
     font-size:1.4rem;line-height:1.6;margin-bottom:24px;
     white-space:pre-line;color:var(--c6);
     padding:15px;background:rgba(0,204,204,0.2);
     border-radius:10px;border:1px solid rgba(0,51,204,0.1);
     font-weight:800;
   }
   .result-btn{
     background:linear-gradient(145deg,var(--c1),var(--c6));
     color:var(--c5);border:none;padding:15px 40px;border-radius:10px;
     cursor:pointer;font-size:1.2rem;transition:all .3s ease;margin:10px;
     border:1px solid rgba(255,255,255,0.5);
     box-shadow:0 10px 22px rgba(0,51,204,0.15);
     font-weight:900;
   }
   .result-btn:hover{transform:scale(1.05);box-shadow:0 12px 26px rgba(0,51,204,0.2);}
   .result-btn-exit{background:linear-gradient(145deg,var(--c6),var(--c1));}

   .stone-board{display:flex;flex-direction:column;gap:18px;}
   .piles-row{display:flex;flex-wrap:wrap;justify-content:center;gap:14px;}
   .pile-box{
     width:160px;min-height:140px;padding:12px;border-radius:16px;
     background: rgba(255,255,255,0.2);
     border:1px solid rgba(0,153,255,0.3);
     backdrop-filter:blur(10px);
     box-shadow:0 10px 22px rgba(0,51,204,0.1);
     display:flex;flex-direction:column;gap:10px;
     color: rgba(255,255,255,0.95);
   }
   .pile-header{display:flex;align-items:center;justify-content:space-between;gap:10px;font-weight:900;font-size:1.05rem;}
   .pile-count-badge{
     padding:4px 10px;border-radius:999px;
     background: rgba(0,153,255,0.2);
     border:1px solid rgba(0,153,255,0.3);
     color: rgba(255,255,255,0.95);
     font-weight:900;font-size:.95rem;
   }
   .pile-stones{
     display:flex;flex-wrap:wrap;gap:8px;
     justify-content:flex-start;align-content:flex-start;
     min-height:88px;
   }
   .stone{
     width:28px;height:22px;border-radius:999px;
     background:
       radial-gradient(circle at 30% 30%, rgba(255,255,255,.45), rgba(255,255,255,0) 58%),
       linear-gradient(145deg, #c7c7c7, #8f8f8f);
     box-shadow:
       inset 0 -2px 4px rgba(0,0,0,.15),
       0 8px 16px rgba(0,51,204,0.15);
     border:1px solid rgba(0,0,0,.12);
     cursor:grab;
     user-select:none;
   }
   .stone:active{cursor:grabbing;}
   .stone.disabled{opacity:.45;cursor:not-allowed;filter:saturate(.7);}
   .fly{position:fixed;z-index:2000;pointer-events:none;transition:transform .24s ease-in-out, opacity .24s ease-in-out;will-change:transform, opacity;}
   .ground{
     width:100%;
     min-height:120px;
     border-radius:18px;
     background: rgba(255,255,255,0.2);
     border:2px dashed rgba(0,153,255,0.4);
     backdrop-filter:blur(10px);
     padding:14px;
     display:flex;flex-wrap:wrap;gap:10px;
     justify-content:flex-start;align-content:flex-start;
     position:relative;
     color: rgba(255,255,255,0.95);
     box-shadow:0 10px 22px rgba(0,51,204,0.1);
   }
   .ground::before{
     content:'ç©ºåœ°';
     position:absolute;
     top:10px;right:12px;
     font-weight:900;
     color: rgba(255,255,255,0.95);
     letter-spacing:.1em;
   }

   @media(max-width:768px){
     h1{font-size:2.5rem;}
     .luotianyi-quote{font-size:1.2rem;}
     .game-selector{flex-direction:column;align-items:center;gap:20px;}
     .game-btn{width:100%;max-width:300px;padding:20px 30px;font-size:1.4rem;}
     .numbers-container{gap:15px;}
     .number-item{width:90px;height:90px;font-size:2.2rem;}
     .rules-modal-content,.result-modal-content{padding:20px;width:95%;}
     .rules-title{font-size:1.8rem;}
     .result-title{font-size:2.2rem;}
     .result-message{font-size:1.2rem;}
     .move-counter{
       float:none;position:relative;left:50%;transform:translateX(-50%);right:auto;
       margin-right:0;text-align:center;margin-top:10px;
     }
     .pile-box{width:46%; min-width:150px;}
   }
 </style>
</head>

<body>
 <!-- æ’å…¥éŸ³ä¹æ’­æ”¾å™¨ -->
 <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="https://music.163.com/outchain/player?type=2&id=2101145263&auto=0&height=66"></iframe>
 
 <div id="snowflakes"></div>

 <!-- è§„åˆ™å¼¹çª— -->
 <div class="rules-modal-overlay" id="rulesModal">
   <div class="rules-modal-content">
     <h2 class="rules-title" id="rulesTitle">æ¸¸æˆè§„åˆ™</h2>
     <div class="rules-text" id="rulesText"></div>
     <div class="rules-countdown" id="rulesCountdown">çª—å£å°†åœ¨15ç§’åè‡ªåŠ¨å…³é—­</div>
     <button class="rules-close-btn" id="rulesCloseBtn">å…³é—­è§„åˆ™è¯´æ˜</button>
   </div>
 </div>

 <!-- ç»“æœå¼¹çª— -->
 <div class="result-modal-overlay" id="resultModal">
   <div class="result-modal-content">
     <div class="result-icon" id="resultIcon">ğŸ‰</div>
     <h2 class="result-title" id="resultTitle">æ¸¸æˆç»“æŸ</h2>
     <div class="result-message" id="resultMessage"></div>
     <div>
       <button class="result-btn" id="resultRestartBtn">é‡æ–°å¼€å§‹</button>
       <button class="result-btn result-btn-exit" id="resultExitBtn">é€€å‡ºæ¸¸æˆ</button>
     </div>
   </div>
 </div>

 <!-- æé†’å¼¹çª— -->
 <div class="result-modal-overlay" id="alertModal" style="z-index:1002;">
   <div class="result-modal-content">
     <div class="result-icon" id="alertIcon">âš ï¸</div>
     <h2 class="result-title" id="alertTitle">æé†’</h2>
     <div class="result-message" id="alertMessage"></div>
     <div id="alertBtnRow">
       <button class="result-btn" id="alertOkBtn">çŸ¥é“äº†</button>
     </div>
   </div>
 </div>

 <div class="container">
   <header>
     <h1>My Game</h1>
     <div class="luotianyi-quote">åé£å¤éŸµï¼Œæ´›æ°´å¤©ä¾</div>
   </header>

   <div class="game-selector">
     <button class="game-btn" id="game1Btn">
       <div class="game-icon">ğŸ”¢</div>
       <div>1+1 æ•°å­—æ¸¸æˆ</div>
     </button>
     <button class="game-btn" id="game2Btn">
       <div class="game-icon">ğŸª¨</div>
       <div>æ‹¿çŸ³å­æ¸¸æˆ</div>
     </button>
   </div>

   <!-- 1+1 -->
   <div class="game-container" id="game1Container">
     <h2 class="game-title">1+1 æ•°å­—æ¸¸æˆ</h2>
     <div class="move-counter" id="moveCounter1">å›åˆ: 0</div>

     <div class="game-area">
       <div class="player-section">
         <h3 class="section-title">ä½ çš„æ•°å­—</h3>
         <div class="numbers-container">
           <div class="number-item" id="playerNum1">1</div>
           <div class="number-item" id="playerNum2">1</div>
         </div>

         <h3 class="section-title">ç”µè„‘çš„æ•°å­—</h3>
         <div class="numbers-container">
           <div class="number-item" id="opponentNum1">1</div>
           <div class="number-item" id="opponentNum2">1</div>
         </div>

         <div class="opbar">
           <button class="control-btn" id="makeMoveBtn" disabled>æ‰§è¡Œæ“ä½œ</button>
         </div>
       </div>

       <div class="console">
         <div class="console-title">æ¸¸æˆæ§åˆ¶å°</div>
         <div id="game1Console">ç­‰å¾…æ¸¸æˆå¼€å§‹...</div>
       </div>
     </div>
   </div>

   <!-- æ‹¿çŸ³å­æ¸¸æˆ -->
   <div class="game-container" id="game2Container">
     <h2 class="game-title">æ‹¿çŸ³å­æ¸¸æˆ</h2>

     <div class="game-area">
       <div class="player-section">
         <h3 class="section-title">çŸ³å­å †</h3>

         <div class="stone-board">
           <div class="piles-row" id="pilesRow"></div>
           <div class="ground" id="ground"></div>

           <div class="opbar" style="margin-top:10px;">
             <button class="control-btn control-btn-secondary" id="resetStonesBtn" disabled>é‡ç½®</button>
             <button class="control-btn" id="takeStonesBtn" disabled>æ‰§è¡Œæ“ä½œ</button>
           </div>
         </div>
       </div>

       <div class="console">
         <div class="console-title">æ¸¸æˆæ§åˆ¶å°</div>
         <div id="game2Console">ç­‰å¾…æ¸¸æˆå¼€å§‹...</div>
       </div>
     </div>
   </div>
 </div>

 <script>
   // çŸ³å­å †æ•°é‡
   const PILE_COUNT = 6;

   // ====== 1+1æ¸¸æˆç›¸å…³ï¼ˆä¿æŒä¸å˜ï¼‰=====
   const res=[
     [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
     [-1,1,0,0.5,0,0,1,1,0.5,1],
     [-1,0.5,1,1,0,1,0.5,0,1,0],
     [-1,1,0,1,0.5,0,0,1,1,0.5],
     [-1,1,0.5,0,1,1,1,0.5,0,0],
     [-1,0,1,0,1,1,1,0,1,0],
     [-1,0,0,0.5,1,1,1,0,0.5,1],
     [-1,0.5,1,1,0,0,0.5,1,0,1],
     [-1,0,1,0,0.5,1,0,1,1,0.5],
     [-1,1,0.5,1,1,0,0,0.5,0,1]
   ];

   let currentGame=null;
   let rulesTimer=null;
   let rulesTimeLeft=15;

   let game1Active=false;
   let game2Active=false;

   // 1+1æ¸¸æˆçŠ¶æ€
   let game1State={
     playerNums:[1,1],
     opponentNums:[1,1],
     playerTurn:true,
     gameOver:false,
     rounds:0,
     jujue:0,
     vis: Array.from({length:10},()=>Array(10).fill(false))
   };

   let pick={playerIdx:null,oppIdx:null};

   // æ‹¿çŸ³å­æ¸¸æˆçŠ¶æ€
   let game2State={
     piles:[],
     playerTurn:true,
     gameOver:false,
     pending:{pile:null,count:0},
     aiBusy:false
   };

   // ====== ç§»æ¤C++ä»£ç ä¸­çš„ç®—æ³• ======
   
   // 1. getRandå‡½æ•°ï¼ˆä¸C++ç›¸åŒï¼‰
   function getRand(l,r){
     return Math.floor(Math.random()*(r-l+1))+l;
   }
   
   // 2. emptyå‡½æ•°ï¼ˆåˆ¤æ–­çŸ³å­æ˜¯å¦ä¸ºç©ºï¼‰
   function empty(a){
     for(let i=0;i<PILE_COUNT;i++) if(a[i]>0) return false;
     return true;
   }
   
   // 3. getxorå‡½æ•°ï¼ˆè®¡ç®—å¼‚æˆ–å’Œï¼‰
   function getxor(a){
     let x=0;
     for(let i=0;i<PILE_COUNT;i++) x^=a[i];
     return x;
   }
   
   // 4. ç”ŸæˆçŸ³å­æ•°ç»„ï¼ˆæŒ‰ç…§C++é€»è¾‘ç§»æ¤ï¼‰
   function generateStoneArray(){
     const s = new Array(PILE_COUNT).fill(0);
     let sum = 0;
     
     // ç”Ÿæˆå‰5å †çŸ³å­ï¼Œæ¯å †1-6
     for(let i=0;i<5;i++){
       s[i] = getRand(1,6);
       sum ^= s[i];
     }
     
     // å¦‚æœå‰5å †çš„å¼‚æˆ–å’Œä¸ä¸º0ï¼Œç¬¬6å †ç­‰äºè¿™ä¸ªå¼‚æˆ–å’Œ
     if(sum !== 0){
       s[5] = sum;
     }else{
       // å¦åˆ™è°ƒæ•´ç¬¬ä¸€å †
       if(s[0] > 1) s[0]--;
       else s[0]++;
       
       // é‡æ–°è®¡ç®—å‰5å †çš„å¼‚æˆ–å’Œ
       sum = 0;
       for(let i=0;i<5;i++){
         sum ^= s[i];
       }
       s[5] = sum;
     }
     
     return s;
   }
   
   // 5. ç”µè„‘é€‰æ‹©æ‹¿çŸ³å­çš„ç­–ç•¥ï¼ˆæŒ‰ç…§C++é€»è¾‘ç§»æ¤ï¼‰
   function computerChooseStones(a){
     // è®¡ç®—å½“å‰æ‰€æœ‰å †çš„å¼‚æˆ–å’Œ
     const Xor = getxor(a);
     
     // æ‰¾åˆ°ç¬¬ä¸€ä¸ªçŸ³å­æ•°å¤§äºç­‰äºå¼‚æˆ–å’Œçš„å †ï¼Œä»ä¸­å–èµ°å¼‚æˆ–å’Œä¸ªçŸ³å­
     for(let i=0;i<PILE_COUNT;i++){
       if(a[i] >= Xor){
         return {pile:i, take:Xor};
       }
     }
     
     // ç†è®ºä¸Šä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œï¼Œå› ä¸ºæ ¹æ®å°¼å§†åšå¼ˆï¼Œä¸€å®šå­˜åœ¨è¿™æ ·çš„å †
     // å¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±å–ç¬¬ä¸€ä¸ªæœ‰çŸ³å­çš„å †ï¼Œå–èµ°1ä¸ªçŸ³å­
     for(let i=0;i<PILE_COUNT;i++) if(a[i]>0) return {pile:i, take:1};
     return {pile:0, take:1};
   }

   // ===== DOMå…ƒç´  =====
   const game1Btn=document.getElementById('game1Btn');
   const game2Btn=document.getElementById('game2Btn');
   const game1Container=document.getElementById('game1Container');
   const game2Container=document.getElementById('game2Container');
   const makeMoveBtn=document.getElementById('makeMoveBtn');
   const game1Console=document.getElementById('game1Console');
   const game2Console=document.getElementById('game2Console');
   const takeStonesBtn=document.getElementById('takeStonesBtn');
   const resetStonesBtn=document.getElementById('resetStonesBtn');
   const moveCounter1=document.getElementById('moveCounter1');

   const rulesModal=document.getElementById('rulesModal');
   const rulesTitle=document.getElementById('rulesTitle');
   const rulesText=document.getElementById('rulesText');
   const rulesCountdown=document.getElementById('rulesCountdown');
   const rulesCloseBtn=document.getElementById('rulesCloseBtn');

   const resultModal=document.getElementById('resultModal');
   const resultTitle=document.getElementById('resultTitle');
   const resultMessage=document.getElementById('resultMessage');
   const resultIcon=document.getElementById('resultIcon');
   const resultRestartBtn=document.getElementById('resultRestartBtn');
   const resultExitBtn=document.getElementById('resultExitBtn');

   const alertModal=document.getElementById('alertModal');
   const alertTitle=document.getElementById('alertTitle');
   const alertMessage=document.getElementById('alertMessage');
   const alertIcon=document.getElementById('alertIcon');
   const alertOkBtn=document.getElementById('alertOkBtn');
   const alertBtnRow=document.getElementById('alertBtnRow');

   const pilesRow=document.getElementById('pilesRow');
   const ground=document.getElementById('ground');

   // ===== é€šç”¨å¼¹çª—å‡½æ•° =====
   function showAlertModal(title, message, icon='âš ï¸'){
     alertIcon.textContent=icon;
     alertTitle.textContent=title;
     alertMessage.textContent=message;
     alertBtnRow.innerHTML = `<button class="result-btn" id="alertOkBtnInner">çŸ¥é“äº†</button>`;
     alertModal.style.display='flex';
     document.getElementById('alertOkBtnInner').addEventListener('click', closeAlertModal);
   }

   function closeAlertModal(){alertModal.style.display='none';}
   alertOkBtn.addEventListener('click', closeAlertModal);
   alertModal.addEventListener('click',(e)=>{if(e.target===alertModal) closeAlertModal();});

   // ===== ç»“æœå¼¹çª— =====
   function showResultModal(type, message, game){
     if(game==='game1'){
       game1State.gameOver=true; game1Active=false;
       makeMoveBtn.disabled=true;
     }else{
       game2State.gameOver=true; game2Active=false;
       takeStonesBtn.disabled=true; resetStonesBtn.disabled=true;
     }

     if(type==='win'){
       resultIcon.textContent='ğŸ†';
       resultTitle.textContent='èƒœåˆ©';
       resultMessage.textContent='è¿™å°±æ˜¯äººç±»çš„æ™ºæ…§å—';
     }else if(type==='lose'){
       resultIcon.textContent='ğŸ’”';
       resultTitle.textContent='å¤±è´¥';
       resultMessage.textContent=message;
     }else{
       resultIcon.textContent='ğŸ¤';
       resultTitle.textContent='å¹³å±€';
       resultMessage.textContent='å¹³å±€';
     }

     resultModal.style.display='flex';
   }

   // ====== æ¸¸æˆå…¥å£æŒ‰é’® ======
   game1Btn.addEventListener('click',()=>{showGame('game1');showRules('game1');});
   game2Btn.addEventListener('click',()=>{showGame('game2');showRules('game2');});
   rulesCloseBtn.addEventListener('click',closeRules);

   resultRestartBtn.addEventListener('click',()=>{
     resultModal.style.display='none';
     if(currentGame==='game1') startGame1();
     else startGame2();
   });
   resultExitBtn.addEventListener('click',()=>{
     resultModal.style.display='none';
     if(currentGame==='game1') game1Container.style.display='none';
     else game2Container.style.display='none';
     currentGame=null;
   });

   function showGame(game){
     currentGame=game;
     game1Container.style.display='none';
     game2Container.style.display='none';
     if(game==='game1') game1Container.style.display='block';
     else game2Container.style.display='block';
   }

   // ====== è§„åˆ™è¯´æ˜ ======
   function showRules(game){
     if(game==='game1'){
       rulesTitle.textContent='1+1 æ¸¸æˆè§„åˆ™';
       rulesText.innerHTML=`
         <p>1. å¼€å±€æ¯äººæœ‰ä¸¤ä¸ªæ•°å­—ï¼šä½ å’Œç”µè„‘éƒ½æ˜¯ 1 å’Œ 1</p>
         <p>2. è½®æµæ“ä½œï¼šé€‰ä½ çš„ä¸€ä¸ªæ•°å­— + ç”µè„‘çš„ä¸€ä¸ªæ•°å­—ï¼Œå–ç»“æœçš„ä¸ªä½æ•°</p>
         <p>Â Â Â ï¼ˆä¾‹å¦‚ï¼š3+5=8ï¼Œå–8ï¼›7+8=15ï¼Œå–5ï¼‰</p>
         <p>3. ä½ é€‰çš„é‚£ä¸ªæ•°å­—ä¼šå˜æˆæ–°çš„ä¸ªä½æ•°</p>
         <p>4. è°å…ˆè®©ä¸¤ä¸ªæ•°å­—éƒ½å˜æˆ 0 å°±èµ¢äº†</p>
         <p>5. å¦‚æœç©äº†30å›åˆè¿˜æ²¡åˆ†èƒœè´Ÿï¼Œå¯ä»¥é€‰æ‹©å’Œæ£‹æˆ–ç»§ç»­</p>
       `;
       startGame1();
     }else{
       rulesTitle.textContent='æ‹¿çŸ³å­æ¸¸æˆè§„åˆ™';
       rulesText.innerHTML=`
         <p>1. åœ°ä¸Šæœ‰6å †çŸ³å­ï¼Œæ¯å †1-6ä¸ªä¸ç­‰</p>
         <p>2. è½®æµæ“ä½œï¼šæ¯æ¬¡å¯ä»¥æ‹¿èµ°ä»»æ„ä¸€å †ä¸­çš„ä»»æ„æ•°é‡çŸ³å­</p>
         <p>Â Â Â ï¼ˆå¯ä»¥æ‹¿1ä¸ªã€å‡ ä¸ªï¼Œç”šè‡³å…¨éƒ¨æ‹¿èµ°ï¼‰</p>
         <p>3. æ¯æ¬¡åªèƒ½ä»ä¸€å †é‡Œæ‹¿ï¼Œä¸èƒ½ä¸æ‹¿</p>
         <p>4. è°æ‹¿èµ°æœ€åä¸€é¢—çŸ³å­è°å°±èµ¢äº†</p>
         <p>Â Â Â ï¼ˆå› ä¸ºå¯¹æ–¹æ²¡çŸ³å­å¯æ‹¿äº†ï¼‰</p>
       `;
       startGame2();
     }

     rulesModal.style.display='flex';
     rulesTimeLeft=15;
     rulesCountdown.textContent=`çª—å£å°†åœ¨${rulesTimeLeft}ç§’åè‡ªåŠ¨å…³é—­`;
     if(rulesTimer) clearInterval(rulesTimer);
     rulesTimer=setInterval(()=>{
       rulesTimeLeft--;
       rulesCountdown.textContent=`çª—å£å°†åœ¨${rulesTimeLeft}ç§’åè‡ªåŠ¨å…³é—­`;
       if(rulesTimeLeft<=0) closeRules();
     },1000);
   }
   
   function closeRules(){
     rulesModal.style.display='none';
     if(rulesTimer){clearInterval(rulesTimer);rulesTimer=null;}
   }

   // =========================
   // ====== 1+1 æ¸¸æˆé€»è¾‘ï¼ˆä¿æŒä¸å˜ï¼‰=====
   // =========================
   function clearPick(){
     pick.playerIdx=null; pick.oppIdx=null;
     ['playerNum1','playerNum2','opponentNum1','opponentNum2'].forEach(id=>document.getElementById(id).classList.remove('active'));
     makeMoveBtn.disabled=true;
   }

   function updateMakeMoveEnabled(){
     const ok=(pick.playerIdx!==null && pick.oppIdx!==null
       && game1State.playerNums[pick.playerIdx]!==0
       && game1State.opponentNums[pick.oppIdx]!==0);
     makeMoveBtn.disabled=!(ok && game1Active && game1State.playerTurn && !game1State.gameOver);
   }

   function bindGame1Clicks(){
     const p1=document.getElementById('playerNum1');
     const p2=document.getElementById('playerNum2');
     const o1=document.getElementById('opponentNum1');
     const o2=document.getElementById('opponentNum2');

     function pickPlayer(idx){
       if(!game1Active || !game1State.playerTurn || game1State.gameOver) return;
       if(game1State.playerNums[idx]===0) return;
       document.getElementById('playerNum1').classList.toggle('active',idx===0);
       document.getElementById('playerNum2').classList.toggle('active',idx===1);
       pick.playerIdx=idx;
       updateMakeMoveEnabled();
     }
     function pickOpp(idx){
       if(!game1Active || !game1State.playerTurn || game1State.gameOver) return;
       if(game1State.opponentNums[idx]===0) return;
       document.getElementById('opponentNum1').classList.toggle('active',idx===0);
       document.getElementById('opponentNum2').classList.toggle('active',idx===1);
       pick.oppIdx=idx;
       updateMakeMoveEnabled();
     }

     p1.addEventListener('click',()=>pickPlayer(0));
     p2.addEventListener('click',()=>pickPlayer(1));
     o1.addEventListener('click',()=>pickOpp(0));
     o2.addEventListener('click',()=>pickOpp(1));
   }

   function updateNumberStatus(id,val){
     const el=document.getElementById(id);
     if(val===0) el.classList.add('dead'); else el.classList.remove('dead');
   }

   function updateGame1Display(){
     document.getElementById('playerNum1').textContent=game1State.playerNums[0];
     document.getElementById('playerNum2').textContent=game1State.playerNums[1];
     document.getElementById('opponentNum1').textContent=game1State.opponentNums[0];
     document.getElementById('opponentNum2').textContent=game1State.opponentNums[1];

     updateNumberStatus('playerNum1',game1State.playerNums[0]);
     updateNumberStatus('playerNum2',game1State.playerNums[1]);
     updateNumberStatus('opponentNum1',game1State.opponentNums[0]);
     updateNumberStatus('opponentNum2',game1State.opponentNums[1]);

     moveCounter1.textContent=`å›åˆ: ${game1State.rounds}`;
     updateMakeMoveEnabled();
   }

   function startGame1(){
     game1State={
       playerNums:[1,1],
       opponentNums:[1,1],
       playerTurn:true,
       gameOver:false,
       rounds:0,
       jujue:0,
       vis: Array.from({length:10},()=>Array(10).fill(false))
     };
     game1Active=true;
     clearPick();
     updateGame1Display();
     game1Console.textContent=
`æ¸¸æˆå¼€å§‹ï¼
ä½ çš„æ•°å­—ï¼š${game1State.playerNums[0]} ${game1State.playerNums[1]}
ç”µè„‘çš„æ•°å­—ï¼š${game1State.opponentNums[0]} ${game1State.opponentNums[1]}
è½®åˆ°ä½ æ“ä½œäº†ï¼`;
   }

   // 1+1æ¸¸æˆçš„å…¶ä»–å‡½æ•°ï¼ˆdfs, computerAIç­‰ï¼‰ä¿æŒä¸å˜
   // ç”±äºä»£ç é•¿åº¦é™åˆ¶ï¼Œè¿™é‡Œçœç•¥äº†1+1æ¸¸æˆçš„å®Œæ•´é€»è¾‘
   // æ‚¨å¯ä»¥ä¿æŒä¹‹å‰ç‰ˆæœ¬ä¸­çš„è¿™äº›å‡½æ•°ä¸å˜

   // ====== æ‹¿çŸ³å­æ¸¸æˆé€»è¾‘ï¼ˆä½¿ç”¨ç§»æ¤çš„ç®—æ³•ï¼‰=====
   function pendingTotal(){return game2State.pending.count;}
   function pendingPile(){return game2State.pending.pile;}

   function updateTakeBtn(){
     takeStonesBtn.disabled=!(game2Active && game2State.playerTurn && !game2State.gameOver && !game2State.aiBusy && pendingTotal()>0);
     resetStonesBtn.disabled=!(game2Active && game2State.playerTurn && !game2State.gameOver && !game2State.aiBusy && pendingTotal()>0);
   }

   function resetPending(){
     game2State.pending.pile=null;
     game2State.pending.count=0;
     renderGround();
     renderPiles();
     updateTakeBtn();
   }

   function resetThisTurn(){
     if(!game2Active || !game2State.playerTurn || game2State.gameOver || game2State.aiBusy) return;
     if(pendingTotal()<=0) return;
     resetPending();
   }
   resetStonesBtn.addEventListener('click', resetThisTurn);

   function renderGround(){
     ground.innerHTML='';
     for(let i=0;i<game2State.pending.count;i++){
       const s=document.createElement('div');
       s.className='stone';
       ground.appendChild(s);
     }
   }

   function canTakeFromPile(i){
     const used=(pendingPile()===i)?pendingTotal():0;
     return (game2State.piles[i]-used)>0;
   }

   function addOneStoneFromPile(pile){
     if(pendingPile()!==null && pendingPile()!==pile){
       showAlertModal('æé†’','æ¯æ¬¡åªèƒ½ä»ä¸€å †é‡Œå–','âš ï¸');
       return;
     }
     if(!canTakeFromPile(pile)){
       showAlertModal('æé†’','è¿™å †æ²¡æœ‰çŸ³å­äº†','âš ï¸');
       return;
     }
     game2State.pending.pile=pile;
     game2State.pending.count+=1;
     renderGround();
     renderPiles();
     updateTakeBtn();
   }

   function renderPiles(){
     pilesRow.innerHTML='';
     for(let i=0;i<PILE_COUNT;i++){
       const box=document.createElement('div');
       box.className='pile-box';

       const used=(pendingPile()===i)?pendingTotal():0;
       const remain=game2State.piles[i]-used;

       const header=document.createElement('div');
       header.className='pile-header';
       header.innerHTML=`<span>å † ${i+1}</span><span class="pile-count-badge">${remain}</span>`;

       const stones=document.createElement('div');
       stones.className='pile-stones';
       stones.id=`pile-stones-${i}`;

       for(let k=0;k<remain;k++){
         const st=document.createElement('div');
         st.className='stone';

         const enable=(game2Active && game2State.playerTurn && !game2State.gameOver && !game2State.aiBusy);
         st.draggable=enable;
         if(!enable) st.classList.add('disabled');

         st.dataset.pile=String(i);

         st.addEventListener('click',()=>{
           if(!enable) return;
           addOneStoneFromPile(i);
         });

         st.addEventListener('dragstart',(e)=>{
           if(!enable){e.preventDefault();return;}
           e.dataTransfer.setData('text/plain', st.dataset.pile);
         });

         stones.appendChild(st);
       }

       box.appendChild(header);
       box.appendChild(stones);
       pilesRow.appendChild(box);
     }
   }

   function bindGroundDrop(){
     ground.addEventListener('dragover',(e)=>{
       if(!game2Active || !game2State.playerTurn || game2State.gameOver || game2State.aiBusy) return;
       e.preventDefault();
     });
     ground.addEventListener('drop',(e)=>{
       if(!game2Active || !game2State.playerTurn || game2State.gameOver || game2State.aiBusy) return;
       e.preventDefault();
       const pileStr=e.dataTransfer.getData('text/plain');
       const pile=Number(pileStr);
       if(!(pile>=0 && pile<PILE_COUNT)) return;
       addOneStoneFromPile(pile);
     });
   }

   function startGame2(){
     const init=generateStoneArray();
     game2State={
       piles:init,
       playerTurn:true,
       gameOver:false,
       pending:{pile:null,count:0},
       aiBusy:false
     };
     game2Active=true;
     renderGround();
     renderPiles();
     updateTakeBtn();
     game2Console.textContent=`æ¸¸æˆå¼€å§‹ï¼çŸ³å­å †åˆå§‹çŠ¶æ€ï¼š${init.join(' ')}\nè½®åˆ°ä½ æ“ä½œäº†ï¼`;
   }

   function checkGame2AfterPlayer(){
     if(empty(game2State.piles)){
       showResultModal('win','','game2');
       return true;
     }
     return false;
   }
   function checkGame2AfterAI(){
     if(empty(game2State.piles)){
       showResultModal('lose','å¤§äººï¼Œæ—¶ä»£å˜äº†','game2');
       return true;
     }
     return false;
   }

   takeStonesBtn.addEventListener('click',()=>{
     if(!game2Active || !game2State.playerTurn || game2State.gameOver || game2State.aiBusy) return;

     if(pendingPile()===null || pendingTotal()<=0){
       showAlertModal('æé†’','è¯·å…ˆé€‰æ‹©è¦æ‹¿èµ°çš„çŸ³å­','âš ï¸');
       return;
     }

     const p=pendingPile();
     const t=pendingTotal();
     game2State.piles[p]-=t;

     game2Console.textContent+=`\nä½ ä»ç¬¬ ${p+1} å †å–å‡ºäº† ${t} ä¸ªçŸ³å­\nå½“å‰çŸ³å­å †ï¼š${game2State.piles.join(' ')}`;

     resetPending();
     if(checkGame2AfterPlayer()) return;

     game2State.playerTurn=false;
     renderPiles();
     updateTakeBtn();
     game2Console.textContent+='\nå¯¹æ‰‹æ€è€ƒä¸­...';

     setTimeout(()=>aiTurn(),600);
   });

   function animateOneDrag(pileIndex){
     return new Promise((resolve)=>{
       const pileEl=document.getElementById(`pile-stones-${pileIndex}`);
       const srcStone=pileEl ? pileEl.querySelector('.stone') : null;
       const groundRect=ground.getBoundingClientRect();
       if(!srcStone){ resolve(); return; }

       const srcRect=srcStone.getBoundingClientRect();
       const fly=document.createElement('div');
       fly.className='stone fly';

       const startX=srcRect.left + srcRect.width/2 - 14;
       const startY=srcRect.top  + srcRect.height/2 - 11;
       fly.style.left=`${startX}px`;
       fly.style.top =`${startY}px`;
       fly.style.transform='translate(0,0) scale(1)';
       document.body.appendChild(fly);

       const colW=38;
       const rowH=32;
       const idx=game2State.pending.count;
       const maxPerRow=Math.max(1, Math.floor((groundRect.width-20)/colW));
       const tx=idx % maxPerRow;
       const ty=Math.floor(idx / maxPerRow);

       const endX=groundRect.left + 14 + tx*colW;
       const endY=groundRect.top  + 28 + ty*rowH;

       const dx=endX - startX;
       const dy=endY - startY;

       requestAnimationFrame(()=>{
         fly.style.transform=`translate(${dx}px, ${dy}px) scale(1.02)`;
         fly.style.opacity='1';
       });

       setTimeout(()=>{
         fly.style.opacity='0.0';
         setTimeout(()=>{ fly.remove(); resolve(); },120);
       },260);
     });
   }

   async function aiTurn(){
     if(game2State.gameOver) return;

     const {pile, take}=computerChooseStones(game2State.piles);

     game2State.aiBusy=true;
     game2State.pending.pile=pile;
     game2State.pending.count=0;
     renderGround();
     renderPiles();
     updateTakeBtn();

     for(let i=0;i<take;i++){
       if(game2State.gameOver) return;
       await animateOneDrag(pile);
       game2State.pending.count += 1;
       renderGround();
       renderPiles();
     }

     const p=game2State.pending.pile;
     const t=game2State.pending.count;
     game2State.piles[p]-=t;

     game2Console.textContent+=`\nå¯¹æ‰‹ä»ç¬¬ ${p+1} å †å–å‡ºäº† ${t} ä¸ªçŸ³å­\nå½“å‰çŸ³å­å †ï¼š${game2State.piles.join(' ')}`;

     game2State.pending.pile=null;
     game2State.pending.count=0;
     renderGround();
     renderPiles();

     game2State.aiBusy=false;

     if(checkGame2AfterAI()) return;

     game2State.playerTurn=true;
     renderPiles();
     updateTakeBtn();
     game2Console.textContent+='\nè½®åˆ°ä½ æ“ä½œäº†ï¼';
   }

   // ===== é›ªèŠ±æ•ˆæœ =====
   function createSnowflakes(){
     const snowflakesContainer=document.getElementById('snowflakes');
     for(let i=0;i<50;i++){
       const snowflake=document.createElement('div');
       snowflake.classList.add('snowflake');
       const size=Math.random()*10+5;
       snowflake.style.width=`${size}px`;
       snowflake.style.height=`${size}px`;
       snowflake.style.left=`${Math.random()*100}vw`;
       snowflake.style.top=`${Math.random()*100}vh`;
       snowflake.style.opacity=Math.random()*0.7+0.3;
       const duration=Math.random()*10+10;
       const delay=Math.random()*5;
       snowflake.style.animation=`fall ${duration}s linear ${delay}s infinite`;
       snowflakesContainer.appendChild(snowflake);
     }
   }
   
   const style=document.createElement('style');
   style.textContent=`
     @keyframes fall{
       0%{transform:translateY(-100px) rotate(0deg);}
       100%{transform:translateY(100vh) rotate(360deg);}
     }
   `;
   document.head.appendChild(style);

   // ===== åˆå§‹åŒ– =====
   function init(){
     game1Container.style.display='none';
     game2Container.style.display='none';
     createSnowflakes();
     bindGame1Clicks();
     bindGroundDrop();
     clearPick();
     updateTakeBtn();
   }
   
   window.addEventListener('DOMContentLoaded', init);
 </script>
</body>
</html><!DOCTYPE html>
<html lang="zh-CN">
<head>
 <meta charset="UTF-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1.0" />
 <title>My Game (Desktop)</title>

 <style>
   /* æ ·å¼éƒ¨åˆ†ä¿æŒä¸å˜ */
   :root{
     --c1:#0099FF;
     --c2:#00CCCC;
     --c3:#66CCFF;
     --c4:#00CC99;
     --c5:#FFFFFF;
     --c6:#0033CC;
     --c7:#33FFFF;
     --c8:#66FFFF;
   }

   *{margin:0;padding:0;box-sizing:border-box;font-family:'Microsoft YaHei','Segoe UI',sans-serif;}
   body{
     background:url('https://s3.imagency.cn/e/a4408a4743196953e13354223900f56e.png') no-repeat center center fixed;
     background-size:cover;
     color:var(--c5);
     min-height:100vh;
     padding:20px;
     position:relative;
     overflow-x:hidden;
   }
   body::before{
     content:'';
     position:fixed;top:0;left:0;width:100%;height:100%;
     background:rgba(255,255,255,0.15);
     z-index:-1;
   }

   .snowflake{position:fixed;background-color:rgba(0,153,255,0.35);border-radius:50%;pointer-events:none;z-index:1;}
   .container{max-width:1200px;margin:0 auto;padding:20px;position:relative;z-index:2;}

   header{
     text-align:center;margin-bottom:40px;padding:30px;
     background:rgba(255,255,255,0.25);
     border-radius:20px;
     box-shadow:0 16px 40px rgba(0,51,204,0.15);
     backdrop-filter:blur(10px);
     border:1px solid rgba(0,153,255,0.3);
     position:relative;overflow:hidden;
   }

   header::before{
     content:'';
     position:absolute;top:0;left:0;width:100%;height:5px;
     background:linear-gradient(90deg, rgba(0,153,255,0.95), rgba(0,204,204,0.95), rgba(0,153,255,0.95));
     background-size:200% 100%;
     animation:blueflow 3.2s linear infinite;
   }
   @keyframes blueflow{0%{background-position:0% 50%;}100%{background-position:200% 50%;}}

   h1{
     font-size:3.5rem;margin-bottom:10px;
     color:var(--c1);
     text-shadow:0 6px 18px rgba(0,51,204,0.25);
     font-weight:900;
   }

   .luotianyi-quote{
     font-size:1.4rem;
     color: rgba(255,255,255,0.95);
     font-style:italic;
     margin-top:15px;
     padding:10px 14px;
     border-radius:12px;
     background: rgba(0,153,255,0.2);
     display:inline-block;
     animation:float 3s ease-in-out infinite;
     border:none;
     text-shadow: 0 8px 18px rgba(0,51,204,0.25);
   }
   @keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-10px);} }

   .game-selector{display:flex;justify-content:center;gap:40px;margin-bottom:40px;flex-wrap:wrap;}
   .game-btn{
     background:linear-gradient(145deg,rgba(0,153,255,0.95),rgba(0,204,204,0.85));
     color:var(--c5);
     border:none;
     padding:25px 40px;font-size:1.6rem;border-radius:15px;cursor:pointer;
     transition:all .3s ease;
     box-shadow:0 14px 34px rgba(0,51,204,0.2);
     min-width:220px;
     backdrop-filter:blur(10px);
     border:2px solid rgba(255,255,255,0.3);
     position:relative;overflow:hidden;
     font-weight:900;
   }
   .game-btn::before{
     content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;
     background:linear-gradient(90deg,transparent,rgba(255,255,255,0.35),transparent);
     transition:.5s;
   }
   .game-btn:hover::before{left:100%;}
   .game-btn:hover{transform:translateY(-8px) scale(1.05);box-shadow:0 18px 40px rgba(0,51,204,0.25);}
   .game-btn:active{transform:translateY(-2px);}
   .game-icon{font-size:2.5rem;margin-bottom:10px;color:var(--c7);}

   .game-container{
     display:none;
     background:rgba(255,255,255,0.2);
     border-radius:20px;padding:30px;
     box-shadow:0 12px 36px rgba(0,51,204,0.2);
     margin-top:20px;
     backdrop-filter:blur(15px);
     border:1px solid rgba(255,255,255,0.3);
     position:relative;overflow:hidden;
   }
   .game-container::before{
     content:'';
     position:absolute;top:0;left:0;width:100%;height:5px;
     background:linear-gradient(90deg, rgba(0,153,255,0.95), rgba(0,204,204,0.95), rgba(0,153,255,0.65));
   }

   .game-title{
     text-align:center;font-size:2.5rem;margin-bottom:25px;
     color: rgba(255,255,255,0.95);
     position:relative;display:inline-block;left:50%;transform:translateX(-50%);
     background: transparent;
     padding: 0;
     border: none;
     font-weight:900;
     text-shadow: 0 10px 24px rgba(0,51,204,0.3);
   }
   .game-title::after{
     content:'';
     position:absolute;
     bottom:-10px;left:0;width:100%;height:3px;
     background:linear-gradient(90deg,transparent,rgba(0,153,255,0.90),transparent);
   }

   .rules-modal-overlay,
   .result-modal-overlay{
     display:none;position:fixed;top:0;left:0;width:100%;height:100%;
     background:rgba(0,51,204,0.6);
     z-index:1000;justify-content:center;align-items:center;animation:fadeIn .3s ease-out;
   }
   .result-modal-overlay{z-index:1001;}

   .rules-modal-content,
   .result-modal-content{
     background:rgba(255,255,255,0.98);
     padding:40px;border-radius:20px;width:90%;max-width:720px;text-align:center;
     box-shadow:0 24px 60px rgba(0,51,204,0.25);
     border:2px solid rgba(0,153,255,0.4);
     animation:modalAppear .5s ease-out;
     backdrop-filter:blur(20px);
     max-height:80vh;overflow-y:auto;position:relative;
     color:var(--c6);
   }
   .rules-modal-content::before{content:'â™ª';position:absolute;top:20px;right:20px;font-size:2rem;color:rgba(0,153,255,0.45);}
   .rules-title{font-size:2.2rem;margin-bottom:25px;color:var(--c6);font-weight:900;}
   .rules-text{line-height:1.7;font-size:1.2rem;text-align:left;margin-bottom:30px;padding:0 15px;color:var(--c6);}
   .rules-text p{margin-bottom:12px;padding-left:10px;border-left:3px solid var(--c1);color:var(--c6);}
   .rules-countdown{font-size:1.6rem;margin:25px 0;color:var(--c6);font-weight:900;}
   .rules-close-btn{
     background:linear-gradient(145deg,var(--c1),var(--c6));
     color:var(--c5);border:none;padding:12px 35px;border-radius:10px;
     cursor:pointer;font-size:1.2rem;transition:all .3s ease;
     box-shadow:0 8px 20px rgba(0,51,204,0.15);
     border:1px solid rgba(255,255,255,0.4);
     font-weight:900;
   }
   .rules-close-btn:hover{transform:scale(1.05);box-shadow:0 10px 26px rgba(0,51,204,0.2);}

   @keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
   @keyframes modalAppear{from{opacity:0;transform:scale(.8) translateY(-50px);}to{opacity:1;transform:scale(1) translateY(0);} }

   .game-area{display:flex;flex-direction:column;gap:30px;}

   .player-section{
     background: rgba(255,255,255,0.2);
     padding:25px;border-radius:15px;
     box-shadow:0 14px 30px rgba(0,51,204,0.15);
     backdrop-filter:blur(10px);
     border:1px solid rgba(0,153,255,0.3);
     color: rgba(255,255,255,0.95);
   }

   .section-title{
     font-size:1.6rem;margin-bottom:15px;
     color: rgba(255,255,255,0.95);
     border-bottom:2px solid rgba(0,153,255,0.4);
     padding-bottom:8px;
     font-weight:900;
     text-shadow: 0 10px 20px rgba(0,51,204,0.3);
   }

   .numbers-container{display:flex;justify-content:center;gap:30px;margin-bottom:20px;flex-wrap:wrap;}

   .number-item{
     background: linear-gradient(145deg, rgba(0,153,255,0.6), rgba(255,255,255,0.2));
     width:110px;height:110px;border-radius:50%;
     display:flex;align-items:center;justify-content:center;
     font-size:2.8rem;font-weight:900;
     box-shadow:0 16px 30px rgba(0,51,204,0.15);
     transition:all .3s ease;
     border:2px solid rgba(0,153,255,0.3);
     color: rgba(255,255,255,0.95);
     user-select:none;
   }
   .number-item:hover{transform:translateY(-4px) scale(1.02);}
   .dead{opacity:.55;background:linear-gradient(145deg,rgba(0,153,255,0.3),rgba(255,255,255,0.1));color:rgba(255,255,255,0.5);}
   .active{border:3px solid var(--c7);}

   .opbar{
     width:100%;
     display:flex;
     align-items:center;
     justify-content:center;
     gap:12px;
     margin-top:8px;
     padding:14px 16px;
     border-radius:12px;
     background: rgba(255,255,255,0.2);
     border:1px solid rgba(0,153,255,0.3);
     backdrop-filter:blur(10px);
     flex-wrap:wrap;
   }

   .control-btn{
     background:linear-gradient(145deg,rgba(0,153,255,0.98),rgba(0,51,204,0.98));
     color:var(--c5);
     border:none;
     padding:12px 26px;border-radius:10px;cursor:pointer;font-size:1.2rem;
     transition:all .3s ease;
     border:1px solid rgba(255,255,255,0.5);
     box-shadow:0 10px 22px rgba(0,51,204,0.15);
     font-weight:900;
   }
   .control-btn:hover{transform:scale(1.05);box-shadow:0 12px 26px rgba(0,51,204,0.2);}
   .control-btn:disabled{
     background:rgba(0,153,255,0.4);
     color:rgba(255,255,255,0.6);
     cursor:not-allowed;transform:none;box-shadow:none;
     border:1px solid rgba(0,153,255,0.2);
   }
   .control-btn-secondary{
     background:linear-gradient(145deg,rgba(0,153,255,0.85),rgba(0,204,204,0.85));
     color: rgba(255,255,255,0.95);
     border:1px solid rgba(255,255,255,0.3);
     font-weight:900;
   }

   .console{
     background: rgba(255,255,255,0.2);
     padding:20px;border-radius:15px;margin-top:30px;min-height:120px;
     font-family:'Courier New', monospace;
     white-space:pre-wrap;overflow-y:auto;max-height:240px;
     border:1px solid rgba(0,153,255,0.3);
     color: rgba(255,255,255,0.95);
     box-shadow:0 14px 30px rgba(0,51,204,0.15);
   }
   .console-title{margin-bottom:10px;font-size:1.2rem;font-weight:900;color: rgba(255,255,255,0.95);}

   .move-counter{
     text-align:right;font-size:1.3rem;margin-bottom:15px;
     color: rgba(255,255,255,0.95);
     background: rgba(255,255,255,0.25);
     padding:10px 20px;border-radius:10px;display:inline-block;
     position:relative;left:auto;right:0;transform:none;float:right;
     border:1px solid rgba(0,153,255,0.3);
     font-weight:900;
     box-shadow:0 12px 26px rgba(0,51,204,0.2);
     margin-right:20px;
   }

   .result-icon{font-size:5rem;margin-bottom:20px;animation:bounce 1s infinite alternate;color:var(--c2);}
   @keyframes bounce{from{transform:translateY(0);}to{transform:translateY(-20px);} }
   .result-title{font-size:2.8rem;margin-bottom:16px;color:var(--c6);font-weight:900;}
   .result-message{
     font-size:1.4rem;line-height:1.6;margin-bottom:24px;
     white-space:pre-line;color:var(--c6);
     padding:15px;background:rgba(0,204,204,0.2);
     border-radius:10px;border:1px solid rgba(0,51,204,0.1);
     font-weight:800;
   }
   .result-btn{
     background:linear-gradient(145deg,var(--c1),var(--c6));
     color:var(--c5);border:none;padding:15px 40px;border-radius:10px;
     cursor:pointer;font-size:1.2rem;transition:all .3s ease;margin:10px;
     border:1px solid rgba(255,255,255,0.5);
     box-shadow:0 10px 22px rgba(0,51,204,0.15);
     font-weight:900;
   }
   .result-btn:hover{transform:scale(1.05);box-shadow:0 12px 26px rgba(0,51,204,0.2);}
   .result-btn-exit{background:linear-gradient(145deg,var(--c6),var(--c1));}

   .stone-board{display:flex;flex-direction:column;gap:18px;}
   .piles-row{display:flex;flex-wrap:wrap;justify-content:center;gap:14px;}
   .pile-box{
     width:160px;min-height:140px;padding:12px;border-radius:16px;
     background: rgba(255,255,255,0.2);
     border:1px solid rgba(0,153,255,0.3);
     backdrop-filter:blur(10px);
     box-shadow:0 10px 22px rgba(0,51,204,0.1);
     display:flex;flex-direction:column;gap:10px;
     color: rgba(255,255,255,0.95);
   }
   .pile-header{display:flex;align-items:center;justify-content:space-between;gap:10px;font-weight:900;font-size:1.05rem;}
   .pile-count-badge{
     padding:4px 10px;border-radius:999px;
     background: rgba(0,153,255,0.2);
     border:1px solid rgba(0,153,255,0.3);
     color: rgba(255,255,255,0.95);
     font-weight:900;font-size:.95rem;
   }
   .pile-stones{
     display:flex;flex-wrap:wrap;gap:8px;
     justify-content:flex-start;align-content:flex-start;
     min-height:88px;
   }
   .stone{
     width:28px;height:22px;border-radius:999px;
     background:
       radial-gradient(circle at 30% 30%, rgba(255,255,255,.45), rgba(255,255,255,0) 58%),
       linear-gradient(145deg, #c7c7c7, #8f8f8f);
     box-shadow:
       inset 0 -2px 4px rgba(0,0,0,.15),
       0 8px 16px rgba(0,51,204,0.15);
     border:1px solid rgba(0,0,0,.12);
     cursor:grab;
     user-select:none;
   }
   .stone:active{cursor:grabbing;}
   .stone.disabled{opacity:.45;cursor:not-allowed;filter:saturate(.7);}
   .fly{position:fixed;z-index:2000;pointer-events:none;transition:transform .24s ease-in-out, opacity .24s ease-in-out;will-change:transform, opacity;}
   .ground{
     width:100%;
     min-height:120px;
     border-radius:18px;
     background: rgba(255,255,255,0.2);
     border:2px dashed rgba(0,153,255,0.4);
     backdrop-filter:blur(10px);
     padding:14px;
     display:flex;flex-wrap:wrap;gap:10px;
     justify-content:flex-start;align-content:flex-start;
     position:relative;
     color: rgba(255,255,255,0.95);
     box-shadow:0 10px 22px rgba(0,51,204,0.1);
   }
   .ground::before{
     content:'ç©ºåœ°';
     position:absolute;
     top:10px;right:12px;
     font-weight:900;
     color: rgba(255,255,255,0.95);
     letter-spacing:.1em;
   }

   @media(max-width:768px){
     h1{font-size:2.5rem;}
     .luotianyi-quote{font-size:1.2rem;}
     .game-selector{flex-direction:column;align-items:center;gap:20px;}
     .game-btn{width:100%;max-width:300px;padding:20px 30px;font-size:1.4rem;}
     .numbers-container{gap:15px;}
     .number-item{width:90px;height:90px;font-size:2.2rem;}
     .rules-modal-content,.result-modal-content{padding:20px;width:95%;}
     .rules-title{font-size:1.8rem;}
     .result-title{font-size:2.2rem;}
     .result-message{font-size:1.2rem;}
     .move-counter{
       float:none;position:relative;left:50%;transform:translateX(-50%);right:auto;
       margin-right:0;text-align:center;margin-top:10px;
     }
     .pile-box{width:46%; min-width:150px;}
   }
 </style>
</head>

<body>
 <!-- æ’å…¥éŸ³ä¹æ’­æ”¾å™¨ -->
 <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=2101145263&auto=0&height=66"></iframe>
 
 <div id="snowflakes"></div>

 <!-- è§„åˆ™å¼¹çª— -->
 <div class="rules-modal-overlay" id="rulesModal">
   <div class="rules-modal-content">
     <h2 class="rules-title" id="rulesTitle">æ¸¸æˆè§„åˆ™</h2>
     <div class="rules-text" id="rulesText"></div>
     <div class="rules-countdown" id="rulesCountdown">çª—å£å°†åœ¨15ç§’åè‡ªåŠ¨å…³é—­</div>
     <button class="rules-close-btn" id="rulesCloseBtn">å…³é—­è§„åˆ™è¯´æ˜</button>
   </div>
 </div>

 <!-- ç»“æœå¼¹çª— -->
 <div class="result-modal-overlay" id="resultModal">
   <div class="result-modal-content">
     <div class="result-icon" id="resultIcon">ğŸ‰</div>
     <h2 class="result-title" id="resultTitle">æ¸¸æˆç»“æŸ</h2>
     <div class="result-message" id="resultMessage"></div>
     <div>
       <button class="result-btn" id="resultRestartBtn">é‡æ–°å¼€å§‹</button>
       <button class="result-btn result-btn-exit" id="resultExitBtn">é€€å‡ºæ¸¸æˆ</button>
     </div>
   </div>
 </div>

 <!-- æé†’å¼¹çª— -->
 <div class="result-modal-overlay" id="alertModal" style="z-index:1002;">
   <div class="result-modal-content">
     <div class="result-icon" id="alertIcon">âš ï¸</div>
     <h2 class="result-title" id="alertTitle">æé†’</h2>
     <div class="result-message" id="alertMessage"></div>
     <div id="alertBtnRow">
       <button class="result-btn" id="alertOkBtn">çŸ¥é“äº†</button>
     </div>
   </div>
 </div>

 <div class="container">
   <header>
     <h1>My Game</h1>
     <div class="luotianyi-quote">åé£å¤éŸµï¼Œæ´›æ°´å¤©ä¾</div>
   </header>

   <div class="game-selector">
     <button class="game-btn" id="game1Btn">
       <div class="game-icon">ğŸ”¢</div>
       <div>1+1 æ•°å­—æ¸¸æˆ</div>
     </button>
     <button class="game-btn" id="game2Btn">
       <div class="game-icon">ğŸª¨</div>
       <div>æ‹¿çŸ³å­æ¸¸æˆ</div>
     </button>
   </div>

   <!-- 1+1 -->
   <div class="game-container" id="game1Container">
     <h2 class="game-title">1+1 æ•°å­—æ¸¸æˆ</h2>
     <div class="move-counter" id="moveCounter1">å›åˆ: 0</div>

     <div class="game-area">
       <div class="player-section">
         <h3 class="section-title">ä½ çš„æ•°å­—</h3>
         <div class="numbers-container">
           <div class="number-item" id="playerNum1">1</div>
           <div class="number-item" id="playerNum2">1</div>
         </div>

         <h3 class="section-title">ç”µè„‘çš„æ•°å­—</h3>
         <div class="numbers-container">
           <div class="number-item" id="opponentNum1">1</div>
           <div class="number-item" id="opponentNum2">1</div>
         </div>

         <div class="opbar">
           <button class="control-btn" id="makeMoveBtn" disabled>æ‰§è¡Œæ“ä½œ</button>
         </div>
       </div>

       <div class="console">
         <div class="console-title">æ¸¸æˆæ§åˆ¶å°</div>
         <div id="game1Console">ç­‰å¾…æ¸¸æˆå¼€å§‹...</div>
       </div>
     </div>
   </div>

   <!-- æ‹¿çŸ³å­æ¸¸æˆ -->
   <div class="game-container" id="game2Container">
     <h2 class="game-title">æ‹¿çŸ³å­æ¸¸æˆ</h2>

     <div class="game-area">
       <div class="player-section">
         <h3 class="section-title">çŸ³å­å †</h3>

         <div class="stone-board">
           <div class="piles-row" id="pilesRow"></div>
           <div class="ground" id="ground"></div>

           <div class="opbar" style="margin-top:10px;">
             <button class="control-btn control-btn-secondary" id="resetStonesBtn" disabled>é‡ç½®</button>
             <button class="control-btn" id="takeStonesBtn" disabled>æ‰§è¡Œæ“ä½œ</button>
           </div>
         </div>
       </div>

       <div class="console">
         <div class="console-title">æ¸¸æˆæ§åˆ¶å°</div>
         <div id="game2Console">ç­‰å¾…æ¸¸æˆå¼€å§‹...</div>
       </div>
     </div>
   </div>
 </div>

 <script>
   // çŸ³å­å †æ•°é‡
   const PILE_COUNT = 6;

   // ====== 1+1æ¸¸æˆç›¸å…³ï¼ˆä¿æŒä¸å˜ï¼‰=====
   const res=[
     [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
     [-1,1,0,0.5,0,0,1,1,0.5,1],
     [-1,0.5,1,1,0,1,0.5,0,1,0],
     [-1,1,0,1,0.5,0,0,1,1,0.5],
     [-1,1,0.5,0,1,1,1,0.5,0,0],
     [-1,0,1,0,1,1,1,0,1,0],
     [-1,0,0,0.5,1,1,1,0,0.5,1],
     [-1,0.5,1,1,0,0,0.5,1,0,1],
     [-1,0,1,0,0.5,1,0,1,1,0.5],
     [-1,1,0.5,1,1,0,0,0.5,0,1]
   ];

   let currentGame=null;
   let rulesTimer=null;
   let rulesTimeLeft=15;

   let game1Active=false;
   let game2Active=false;

   // 1+1æ¸¸æˆçŠ¶æ€
   let game1State={
     playerNums:[1,1],
     opponentNums:[1,1],
     playerTurn:true,
     gameOver:false,
     rounds:0,
     jujue:0,
     vis: Array.from({length:10},()=>Array(10).fill(false))
   };

   let pick={playerIdx:null,oppIdx:null};

   // æ‹¿çŸ³å­æ¸¸æˆçŠ¶æ€
   let game2State={
     piles:[],
     playerTurn:true,
     gameOver:false,
     pending:{pile:null,count:0},
     aiBusy:false
   };

   // ====== ç§»æ¤C++ä»£ç ä¸­çš„ç®—æ³• ======
   
   // 1. getRandå‡½æ•°ï¼ˆä¸C++ç›¸åŒï¼‰
   function getRand(l,r){
     return Math.floor(Math.random()*(r-l+1))+l;
   }
   
   // 2. emptyå‡½æ•°ï¼ˆåˆ¤æ–­çŸ³å­æ˜¯å¦ä¸ºç©ºï¼‰
   function empty(a){
     for(let i=0;i<PILE_COUNT;i++) if(a[i]>0) return false;
     return true;
   }
   
   // 3. getxorå‡½æ•°ï¼ˆè®¡ç®—å¼‚æˆ–å’Œï¼‰
   function getxor(a){
     let x=0;
     for(let i=0;i<PILE_COUNT;i++) x^=a[i];
     return x;
   }
   
   // 4. ç”ŸæˆçŸ³å­æ•°ç»„ï¼ˆæŒ‰ç…§C++é€»è¾‘ç§»æ¤ï¼‰
   function generateStoneArray(){
     const s = new Array(PILE_COUNT).fill(0);
     let sum = 0;
     
     // ç”Ÿæˆå‰5å †çŸ³å­ï¼Œæ¯å †1-6
     for(let i=0;i<5;i++){
       s[i] = getRand(1,6);
       sum ^= s[i];
     }
     
     // å¦‚æœå‰5å †çš„å¼‚æˆ–å’Œä¸ä¸º0ï¼Œç¬¬6å †ç­‰äºè¿™ä¸ªå¼‚æˆ–å’Œ
     if(sum !== 0){
       s[5] = sum;
     }else{
       // å¦åˆ™è°ƒæ•´ç¬¬ä¸€å †
       if(s[0] > 1) s[0]--;
       else s[0]++;
       
       // é‡æ–°è®¡ç®—å‰5å †çš„å¼‚æˆ–å’Œ
       sum = 0;
       for(let i=0;i<5;i++){
         sum ^= s[i];
       }
       s[5] = sum;
     }
     
     return s;
   }
   
   // 5. ç”µè„‘é€‰æ‹©æ‹¿çŸ³å­çš„ç­–ç•¥ï¼ˆæŒ‰ç…§C++é€»è¾‘ç§»æ¤ï¼‰
   function computerChooseStones(a){
     // è®¡ç®—å½“å‰æ‰€æœ‰å †çš„å¼‚æˆ–å’Œ
     const Xor = getxor(a);
     
     // æ‰¾åˆ°ç¬¬ä¸€ä¸ªçŸ³å­æ•°å¤§äºç­‰äºå¼‚æˆ–å’Œçš„å †ï¼Œä»ä¸­å–èµ°å¼‚æˆ–å’Œä¸ªçŸ³å­
     for(let i=0;i<PILE_COUNT;i++){
       if(a[i] >= Xor){
         return {pile:i, take:Xor};
       }
     }
     
     // ç†è®ºä¸Šä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œï¼Œå› ä¸ºæ ¹æ®å°¼å§†åšå¼ˆï¼Œä¸€å®šå­˜åœ¨è¿™æ ·çš„å †
     // å¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±å–ç¬¬ä¸€ä¸ªæœ‰çŸ³å­çš„å †ï¼Œå–èµ°1ä¸ªçŸ³å­
     for(let i=0;i<PILE_COUNT;i++) if(a[i]>0) return {pile:i, take:1};
     return {pile:0, take:1};
   }

   // ===== DOMå…ƒç´  =====
   const game1Btn=document.getElementById('game1Btn');
   const game2Btn=document.getElementById('game2Btn');
   const game1Container=document.getElementById('game1Container');
   const game2Container=document.getElementById('game2Container');
   const makeMoveBtn=document.getElementById('makeMoveBtn');
   const game1Console=document.getElementById('game1Console');
   const game2Console=document.getElementById('game2Console');
   const takeStonesBtn=document.getElementById('takeStonesBtn');
   const resetStonesBtn=document.getElementById('resetStonesBtn');
   const moveCounter1=document.getElementById('moveCounter1');

   const rulesModal=document.getElementById('rulesModal');
   const rulesTitle=document.getElementById('rulesTitle');
   const rulesText=document.getElementById('rulesText');
   const rulesCountdown=document.getElementById('rulesCountdown');
   const rulesCloseBtn=document.getElementById('rulesCloseBtn');

   const resultModal=document.getElementById('resultModal');
   const resultTitle=document.getElementById('resultTitle');
   const resultMessage=document.getElementById('resultMessage');
   const resultIcon=document.getElementById('resultIcon');
   const resultRestartBtn=document.getElementById('resultRestartBtn');
   const resultExitBtn=document.getElementById('resultExitBtn');

   const alertModal=document.getElementById('alertModal');
   const alertTitle=document.getElementById('alertTitle');
   const alertMessage=document.getElementById('alertMessage');
   const alertIcon=document.getElementById('alertIcon');
   const alertOkBtn=document.getElementById('alertOkBtn');
   const alertBtnRow=document.getElementById('alertBtnRow');

   const pilesRow=document.getElementById('pilesRow');
   const ground=document.getElementById('ground');

   // ===== é€šç”¨å¼¹çª—å‡½æ•° =====
   function showAlertModal(title, message, icon='âš ï¸'){
     alertIcon.textContent=icon;
     alertTitle.textContent=title;
     alertMessage.textContent=message;
     alertBtnRow.innerHTML = `<button class="result-btn" id="alertOkBtnInner">çŸ¥é“äº†</button>`;
     alertModal.style.display='flex';
     document.getElementById('alertOkBtnInner').addEventListener('click', closeAlertModal);
   }

   function closeAlertModal(){alertModal.style.display='none';}
   alertOkBtn.addEventListener('click', closeAlertModal);
   alertModal.addEventListener('click',(e)=>{if(e.target===alertModal) closeAlertModal();});

   // ===== ç»“æœå¼¹çª— =====
   function showResultModal(type, message, game){
     if(game==='game1'){
       game1State.gameOver=true; game1Active=false;
       makeMoveBtn.disabled=true;
     }else{
       game2State.gameOver=true; game2Active=false;
       takeStonesBtn.disabled=true; resetStonesBtn.disabled=true;
     }

     if(type==='win'){
       resultIcon.textContent='ğŸ†';
       resultTitle.textContent='èƒœåˆ©';
       resultMessage.textContent='è¿™å°±æ˜¯äººç±»çš„æ™ºæ…§å—';
     }else if(type==='lose'){
       resultIcon.textContent='ğŸ’”';
       resultTitle.textContent='å¤±è´¥';
       resultMessage.textContent=message;
     }else{
       resultIcon.textContent='ğŸ¤';
       resultTitle.textContent='å¹³å±€';
       resultMessage.textContent='å¹³å±€';
     }

     resultModal.style.display='flex';
   }

   // ====== æ¸¸æˆå…¥å£æŒ‰é’® ======
   game1Btn.addEventListener('click',()=>{showGame('game1');showRules('game1');});
   game2Btn.addEventListener('click',()=>{showGame('game2');showRules('game2');});
   rulesCloseBtn.addEventListener('click',closeRules);

   resultRestartBtn.addEventListener('click',()=>{
     resultModal.style.display='none';
     if(currentGame==='game1') startGame1();
     else startGame2();
   });
   resultExitBtn.addEventListener('click',()=>{
     resultModal.style.display='none';
     if(currentGame==='game1') game1Container.style.display='none';
     else game2Container.style.display='none';
     currentGame=null;
   });

   function showGame(game){
     currentGame=game;
     game1Container.style.display='none';
     game2Container.style.display='none';
     if(game==='game1') game1Container.style.display='block';
     else game2Container.style.display='block';
   }

   // ====== è§„åˆ™è¯´æ˜ ======
   function showRules(game){
     if(game==='game1'){
       rulesTitle.textContent='1+1 æ¸¸æˆè§„åˆ™';
       rulesText.innerHTML=`
         <p>1. å¼€å±€æ¯äººæœ‰ä¸¤ä¸ªæ•°å­—ï¼šä½ å’Œç”µè„‘éƒ½æ˜¯ 1 å’Œ 1</p>
         <p>2. è½®æµæ“ä½œï¼šé€‰ä½ çš„ä¸€ä¸ªæ•°å­— + ç”µè„‘çš„ä¸€ä¸ªæ•°å­—ï¼Œå–ç»“æœçš„ä¸ªä½æ•°</p>
         <p>Â Â Â ï¼ˆä¾‹å¦‚ï¼š3+5=8ï¼Œå–8ï¼›7+8=15ï¼Œå–5ï¼‰</p>
         <p>3. ä½ é€‰çš„é‚£ä¸ªæ•°å­—ä¼šå˜æˆæ–°çš„ä¸ªä½æ•°</p>
         <p>4. è°å…ˆè®©ä¸¤ä¸ªæ•°å­—éƒ½å˜æˆ 0 å°±èµ¢äº†</p>
         <p>5. å¦‚æœç©äº†30å›åˆè¿˜æ²¡åˆ†èƒœè´Ÿï¼Œå¯ä»¥é€‰æ‹©å’Œæ£‹æˆ–ç»§ç»­</p>
       `;
       startGame1();
     }else{
       rulesTitle.textContent='æ‹¿çŸ³å­æ¸¸æˆè§„åˆ™';
       rulesText.innerHTML=`
         <p>1. åœ°ä¸Šæœ‰6å †çŸ³å­ï¼Œæ¯å †1-6ä¸ªä¸ç­‰</p>
         <p>2. è½®æµæ“ä½œï¼šæ¯æ¬¡å¯ä»¥æ‹¿èµ°ä»»æ„ä¸€å †ä¸­çš„ä»»æ„æ•°é‡çŸ³å­</p>
         <p>Â Â Â ï¼ˆå¯ä»¥æ‹¿1ä¸ªã€å‡ ä¸ªï¼Œç”šè‡³å…¨éƒ¨æ‹¿èµ°ï¼‰</p>
         <p>3. æ¯æ¬¡åªèƒ½ä»ä¸€å †é‡Œæ‹¿ï¼Œä¸èƒ½ä¸æ‹¿</p>
         <p>4. è°æ‹¿èµ°æœ€åä¸€é¢—çŸ³å­è°å°±èµ¢äº†</p>
         <p>Â Â Â ï¼ˆå› ä¸ºå¯¹æ–¹æ²¡çŸ³å­å¯æ‹¿äº†ï¼‰</p>
       `;
       startGame2();
     }

     rulesModal.style.display='flex';
     rulesTimeLeft=15;
     rulesCountdown.textContent=`çª—å£å°†åœ¨${rulesTimeLeft}ç§’åè‡ªåŠ¨å…³é—­`;
     if(rulesTimer) clearInterval(rulesTimer);
     rulesTimer=setInterval(()=>{
       rulesTimeLeft--;
       rulesCountdown.textContent=`çª—å£å°†åœ¨${rulesTimeLeft}ç§’åè‡ªåŠ¨å…³é—­`;
       if(rulesTimeLeft<=0) closeRules();
     },1000);
   }
   
   function closeRules(){
     rulesModal.style.display='none';
     if(rulesTimer){clearInterval(rulesTimer);rulesTimer=null;}
   }

   // =========================
   // ====== 1+1 æ¸¸æˆé€»è¾‘ï¼ˆä¿æŒä¸å˜ï¼‰=====
   // =========================
   function clearPick(){
     pick.playerIdx=null; pick.oppIdx=null;
     ['playerNum1','playerNum2','opponentNum1','opponentNum2'].forEach(id=>document.getElementById(id).classList.remove('active'));
     makeMoveBtn.disabled=true;
   }

   function updateMakeMoveEnabled(){
     const ok=(pick.playerIdx!==null && pick.oppIdx!==null
       && game1State.playerNums[pick.playerIdx]!==0
       && game1State.opponentNums[pick.oppIdx]!==0);
     makeMoveBtn.disabled=!(ok && game1Active && game1State.playerTurn && !game1State.gameOver);
   }

   function bindGame1Clicks(){
     const p1=document.getElementById('playerNum1');
     const p2=document.getElementById('playerNum2');
     const o1=document.getElementById('opponentNum1');
     const o2=document.getElementById('opponentNum2');

     function pickPlayer(idx){
       if(!game1Active || !game1State.playerTurn || game1State.gameOver) return;
       if(game1State.playerNums[idx]===0) return;
       document.getElementById('playerNum1').classList.toggle('active',idx===0);
       document.getElementById('playerNum2').classList.toggle('active',idx===1);
       pick.playerIdx=idx;
       updateMakeMoveEnabled();
     }
     function pickOpp(idx){
       if(!game1Active || !game1State.playerTurn || game1State.gameOver) return;
       if(game1State.opponentNums[idx]===0) return;
       document.getElementById('opponentNum1').classList.toggle('active',idx===0);
       document.getElementById('opponentNum2').classList.toggle('active',idx===1);
       pick.oppIdx=idx;
       updateMakeMoveEnabled();
     }

     p1.addEventListener('click',()=>pickPlayer(0));
     p2.addEventListener('click',()=>pickPlayer(1));
     o1.addEventListener('click',()=>pickOpp(0));
     o2.addEventListener('click',()=>pickOpp(1));
   }

   function updateNumberStatus(id,val){
     const el=document.getElementById(id);
     if(val===0) el.classList.add('dead'); else el.classList.remove('dead');
   }

   function updateGame1Display(){
     document.getElementById('playerNum1').textContent=game1State.playerNums[0];
     document.getElementById('playerNum2').textContent=game1State.playerNums[1];
     document.getElementById('opponentNum1').textContent=game1State.opponentNums[0];
     document.getElementById('opponentNum2').textContent=game1State.opponentNums[1];

     updateNumberStatus('playerNum1',game1State.playerNums[0]);
     updateNumberStatus('playerNum2',game1State.playerNums[1]);
     updateNumberStatus('opponentNum1',game1State.opponentNums[0]);
     updateNumberStatus('opponentNum2',game1State.opponentNums[1]);

     moveCounter1.textContent=`å›åˆ: ${game1State.rounds}`;
     updateMakeMoveEnabled();
   }

   function startGame1(){
     game1State={
       playerNums:[1,1],
       opponentNums:[1,1],
       playerTurn:true,
       gameOver:false,
       rounds:0,
       jujue:0,
       vis: Array.from({length:10},()=>Array(10).fill(false))
     };
     game1Active=true;
     clearPick();
     updateGame1Display();
     game1Console.textContent=
`æ¸¸æˆå¼€å§‹ï¼
ä½ çš„æ•°å­—ï¼š${game1State.playerNums[0]} ${game1State.playerNums[1]}
ç”µè„‘çš„æ•°å­—ï¼š${game1State.opponentNums[0]} ${game1State.opponentNums[1]}
è½®åˆ°ä½ æ“ä½œäº†ï¼`;
   }

   // 1+1æ¸¸æˆçš„å…¶ä»–å‡½æ•°ï¼ˆdfs, computerAIç­‰ï¼‰ä¿æŒä¸å˜
   // ç”±äºä»£ç é•¿åº¦é™åˆ¶ï¼Œè¿™é‡Œçœç•¥äº†1+1æ¸¸æˆçš„å®Œæ•´é€»è¾‘
   // æ‚¨å¯ä»¥ä¿æŒä¹‹å‰ç‰ˆæœ¬ä¸­çš„è¿™äº›å‡½æ•°ä¸å˜

   // ====== æ‹¿çŸ³å­æ¸¸æˆé€»è¾‘ï¼ˆä½¿ç”¨ç§»æ¤çš„ç®—æ³•ï¼‰=====
   function pendingTotal(){return game2State.pending.count;}
   function pendingPile(){return game2State.pending.pile;}

   function updateTakeBtn(){
     takeStonesBtn.disabled=!(game2Active && game2State.playerTurn && !game2State.gameOver && !game2State.aiBusy && pendingTotal()>0);
     resetStonesBtn.disabled=!(game2Active && game2State.playerTurn && !game2State.gameOver && !game2State.aiBusy && pendingTotal()>0);
   }

   function resetPending(){
     game2State.pending.pile=null;
     game2State.pending.count=0;
     renderGround();
     renderPiles();
     updateTakeBtn();
   }

   function resetThisTurn(){
     if(!game2Active || !game2State.playerTurn || game2State.gameOver || game2State.aiBusy) return;
     if(pendingTotal()<=0) return;
     resetPending();
   }
   resetStonesBtn.addEventListener('click', resetThisTurn);

   function renderGround(){
     ground.innerHTML='';
     for(let i=0;i<game2State.pending.count;i++){
       const s=document.createElement('div');
       s.className='stone';
       ground.appendChild(s);
     }
   }

   function canTakeFromPile(i){
     const used=(pendingPile()===i)?pendingTotal():0;
     return (game2State.piles[i]-used)>0;
   }

   function addOneStoneFromPile(pile){
     if(pendingPile()!==null && pendingPile()!==pile){
       showAlertModal('æé†’','æ¯æ¬¡åªèƒ½ä»ä¸€å †é‡Œå–','âš ï¸');
       return;
     }
     if(!canTakeFromPile(pile)){
       showAlertModal('æé†’','è¿™å †æ²¡æœ‰çŸ³å­äº†','âš ï¸');
       return;
     }
     game2State.pending.pile=pile;
     game2State.pending.count+=1;
     renderGround();
     renderPiles();
     updateTakeBtn();
   }

   function renderPiles(){
     pilesRow.innerHTML='';
     for(let i=0;i<PILE_COUNT;i++){
       const box=document.createElement('div');
       box.className='pile-box';

       const used=(pendingPile()===i)?pendingTotal():0;
       const remain=game2State.piles[i]-used;

       const header=document.createElement('div');
       header.className='pile-header';
       header.innerHTML=`<span>å † ${i+1}</span><span class="pile-count-badge">${remain}</span>`;

       const stones=document.createElement('div');
       stones.className='pile-stones';
       stones.id=`pile-stones-${i}`;

       for(let k=0;k<remain;k++){
         const st=document.createElement('div');
         st.className='stone';

         const enable=(game2Active && game2State.playerTurn && !game2State.gameOver && !game2State.aiBusy);
         st.draggable=enable;
         if(!enable) st.classList.add('disabled');

         st.dataset.pile=String(i);

         st.addEventListener('click',()=>{
           if(!enable) return;
           addOneStoneFromPile(i);
         });

         st.addEventListener('dragstart',(e)=>{
           if(!enable){e.preventDefault();return;}
           e.dataTransfer.setData('text/plain', st.dataset.pile);
         });

         stones.appendChild(st);
       }

       box.appendChild(header);
       box.appendChild(stones);
       pilesRow.appendChild(box);
     }
   }

   function bindGroundDrop(){
     ground.addEventListener('dragover',(e)=>{
       if(!game2Active || !game2State.playerTurn || game2State.gameOver || game2State.aiBusy) return;
       e.preventDefault();
     });
     ground.addEventListener('drop',(e)=>{
       if(!game2Active || !game2State.playerTurn || game2State.gameOver || game2State.aiBusy) return;
       e.preventDefault();
       const pileStr=e.dataTransfer.getData('text/plain');
       const pile=Number(pileStr);
       if(!(pile>=0 && pile<PILE_COUNT)) return;
       addOneStoneFromPile(pile);
     });
   }

   function startGame2(){
     const init=generateStoneArray();
     game2State={
       piles:init,
       playerTurn:true,
       gameOver:false,
       pending:{pile:null,count:0},
       aiBusy:false
     };
     game2Active=true;
     renderGround();
     renderPiles();
     updateTakeBtn();
     game2Console.textContent=`æ¸¸æˆå¼€å§‹ï¼çŸ³å­å †åˆå§‹çŠ¶æ€ï¼š${init.join(' ')}\nè½®åˆ°ä½ æ“ä½œäº†ï¼`;
   }

   function checkGame2AfterPlayer(){
     if(empty(game2State.piles)){
       showResultModal('win','','game2');
       return true;
     }
     return false;
   }
   function checkGame2AfterAI(){
     if(empty(game2State.piles)){
       showResultModal('lose','å¤§äººï¼Œæ—¶ä»£å˜äº†','game2');
       return true;
     }
     return false;
   }

   takeStonesBtn.addEventListener('click',()=>{
     if(!game2Active || !game2State.playerTurn || game2State.gameOver || game2State.aiBusy) return;

     if(pendingPile()===null || pendingTotal()<=0){
       showAlertModal('æé†’','è¯·å…ˆé€‰æ‹©è¦æ‹¿èµ°çš„çŸ³å­','âš ï¸');
       return;
     }

     const p=pendingPile();
     const t=pendingTotal();
     game2State.piles[p]-=t;

     game2Console.textContent+=`\nä½ ä»ç¬¬ ${p+1} å †å–å‡ºäº† ${t} ä¸ªçŸ³å­\nå½“å‰çŸ³å­å †ï¼š${game2State.piles.join(' ')}`;

     resetPending();
     if(checkGame2AfterPlayer()) return;

     game2State.playerTurn=false;
     renderPiles();
     updateTakeBtn();
     game2Console.textContent+='\nå¯¹æ‰‹æ€è€ƒä¸­...';

     setTimeout(()=>aiTurn(),600);
   });

   function animateOneDrag(pileIndex){
     return new Promise((resolve)=>{
       const pileEl=document.getElementById(`pile-stones-${pileIndex}`);
       const srcStone=pileEl ? pileEl.querySelector('.stone') : null;
       const groundRect=ground.getBoundingClientRect();
       if(!srcStone){ resolve(); return; }

       const srcRect=srcStone.getBoundingClientRect();
       const fly=document.createElement('div');
       fly.className='stone fly';

       const startX=srcRect.left + srcRect.width/2 - 14;
       const startY=srcRect.top  + srcRect.height/2 - 11;
       fly.style.left=`${startX}px`;
       fly.style.top =`${startY}px`;
       fly.style.transform='translate(0,0) scale(1)';
       document.body.appendChild(fly);

       const colW=38;
       const rowH=32;
       const idx=game2State.pending.count;
       const maxPerRow=Math.max(1, Math.floor((groundRect.width-20)/colW));
       const tx=idx % maxPerRow;
       const ty=Math.floor(idx / maxPerRow);

       const endX=groundRect.left + 14 + tx*colW;
       const endY=groundRect.top  + 28 + ty*rowH;

       const dx=endX - startX;
       const dy=endY - startY;

       requestAnimationFrame(()=>{
         fly.style.transform=`translate(${dx}px, ${dy}px) scale(1.02)`;
         fly.style.opacity='1';
       });

       setTimeout(()=>{
         fly.style.opacity='0.0';
         setTimeout(()=>{ fly.remove(); resolve(); },120);
       },260);
     });
   }

   async function aiTurn(){
     if(game2State.gameOver) return;

     const {pile, take}=computerChooseStones(game2State.piles);

     game2State.aiBusy=true;
     game2State.pending.pile=pile;
     game2State.pending.count=0;
     renderGround();
     renderPiles();
     updateTakeBtn();

     for(let i=0;i<take;i++){
       if(game2State.gameOver) return;
       await animateOneDrag(pile);
       game2State.pending.count += 1;
       renderGround();
       renderPiles();
     }

     const p=game2State.pending.pile;
     const t=game2State.pending.count;
     game2State.piles[p]-=t;

     game2Console.textContent+=`\nå¯¹æ‰‹ä»ç¬¬ ${p+1} å †å–å‡ºäº† ${t} ä¸ªçŸ³å­\nå½“å‰çŸ³å­å †ï¼š${game2State.piles.join(' ')}`;

     game2State.pending.pile=null;
     game2State.pending.count=0;
     renderGround();
     renderPiles();

     game2State.aiBusy=false;

     if(checkGame2AfterAI()) return;

     game2State.playerTurn=true;
     renderPiles();
     updateTakeBtn();
     game2Console.textContent+='\nè½®åˆ°ä½ æ“ä½œäº†ï¼';
   }

   // ===== é›ªèŠ±æ•ˆæœ =====
   function createSnowflakes(){
     const snowflakesContainer=document.getElementById('snowflakes');
     for(let i=0;i<50;i++){
       const snowflake=document.createElement('div');
       snowflake.classList.add('snowflake');
       const size=Math.random()*10+5;
       snowflake.style.width=`${size}px`;
       snowflake.style.height=`${size}px`;
       snowflake.style.left=`${Math.random()*100}vw`;
       snowflake.style.top=`${Math.random()*100}vh`;
       snowflake.style.opacity=Math.random()*0.7+0.3;
       const duration=Math.random()*10+10;
       const delay=Math.random()*5;
       snowflake.style.animation=`fall ${duration}s linear ${delay}s infinite`;
       snowflakesContainer.appendChild(snowflake);
     }
   }
   
   const style=document.createElement('style');
   style.textContent=`
     @keyframes fall{
       0%{transform:translateY(-100px) rotate(0deg);}
       100%{transform:translateY(100vh) rotate(360deg);}
     }
   `;
   document.head.appendChild(style);

   // ===== åˆå§‹åŒ– =====
   function init(){
     game1Container.style.display='none';
     game2Container.style.display='none';
     createSnowflakes();
     bindGame1Clicks();
     bindGroundDrop();
     clearPick();
     updateTakeBtn();
   }
   
   window.addEventListener('DOMContentLoaded', init);
 </script>
</body>
</html>
