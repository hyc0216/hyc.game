<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Game</title>

  <style>
    :root{
      --c1:#4DD7FA;
      --c2:#FFD166;
      --c3:#F6F8FF;
      --c4:#FFB3C7;
      --c5:#FFFFFF;
      --c6:#6C7CFF;
      --c7:#0B1B3A;
    }

    *{margin:0;padding:0;box-sizing:border-box;font-family:'Microsoft YaHei','Segoe UI',sans-serif;}
    body{
      background:url('https://pic3.zhimg.com/v2-5467960a07a088573ee3fb4cfc90b0c9_r.jpg') no-repeat center center fixed;
      background-size:cover;
      color:var(--c5);
      min-height:100vh;
      padding:20px;
      position:relative;
      overflow-x:hidden;
    }
    body::before{
      content:'';
      position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(11,27,58,.58);
      z-index:-1;
    }

    .snowflake{position:fixed;background-color:rgba(77,215,250,.55);border-radius:50%;pointer-events:none;z-index:1;}
    .container{max-width:1200px;margin:0 auto;padding:20px;position:relative;z-index:2;}

    header{
      text-align:center;margin-bottom:40px;padding:30px;
      background:rgba(12, 22, 45, .22);
      border-radius:20px;
      box-shadow:0 16px 40px rgba(11,27,58,.25);
      backdrop-filter:blur(10px);
      border:1px solid rgba(77,215,250,.22);
      position:relative;overflow:hidden;
    }

    header::before{
      content:'';
      position:absolute;top:0;left:0;width:100%;height:5px;
      background:linear-gradient(90deg, rgba(77,215,250,.95), rgba(108,124,255,.95), rgba(77,215,250,.95));
      background-size:200% 100%;
      animation:blueflow 3.2s linear infinite;
    }
    @keyframes blueflow{0%{background-position:0% 50%;}100%{background-position:200% 50%;}}

    h1{
      font-size:3.5rem;margin-bottom:10px;
      color:var(--c1);
      text-shadow:0 6px 18px rgba(11,27,58,.55);
      font-weight:900;
    }

    .luotianyi-quote{
      font-size:1.4rem;
      color: rgba(246,248,255,.92);
      font-style:italic;
      margin-top:15px;
      padding:10px 14px;
      border-radius:12px;
      background: transparent;
      display:inline-block;
      animation:float 3s ease-in-out infinite;
      border:none;
      text-shadow: 0 8px 18px rgba(11,27,58,.45);
    }
    @keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-10px);} }

    .game-selector{display:flex;justify-content:center;gap:40px;margin-bottom:40px;flex-wrap:wrap;}
    .game-btn{
      background:linear-gradient(145deg,rgba(108,124,255,.95),rgba(77,215,250,.85));
      color:var(--c7);
      border:none;
      padding:25px 40px;font-size:1.6rem;border-radius:15px;cursor:pointer;
      transition:all .3s ease;
      box-shadow:0 14px 34px rgba(11,27,58,.30);
      min-width:220px;
      backdrop-filter:blur(10px);
      border:2px solid rgba(246,248,255,.28);
      position:relative;overflow:hidden;
      font-weight:900;
    }
    .game-btn::before{
      content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;
      background:linear-gradient(90deg,transparent,rgba(246,248,255,.35),transparent);
      transition:.5s;
    }
    .game-btn:hover::before{left:100%;}
    .game-btn:hover{transform:translateY(-8px) scale(1.05);box-shadow:0 18px 40px rgba(11,27,58,.34);}
    .game-btn:active{transform:translateY(-2px);}
    .game-icon{font-size:2.5rem;margin-bottom:10px;color:var(--c2);}

    .game-container{
      display:none;
      background:rgba(246,248,255,.14);
      border-radius:20px;padding:30px;
      box-shadow:0 12px 36px rgba(11,27,58,.26);
      margin-top:20px;
      backdrop-filter:blur(15px);
      border:1px solid rgba(246,248,255,.22);
      position:relative;overflow:hidden;
    }
    .game-container::before{
      content:'';
      position:absolute;top:0;left:0;width:100%;height:5px;
      background:linear-gradient(90deg, rgba(77,215,250,.95), rgba(108,124,255,.95), rgba(77,215,250,.65));
    }

    .game-title{
      text-align:center;font-size:2.5rem;margin-bottom:25px;
      color: rgba(246,248,255,.95);
      position:relative;display:inline-block;left:50%;transform:translateX(-50%);
      background: transparent;
      padding: 0;
      border: none;
      font-weight:900;
      text-shadow: 0 10px 24px rgba(11,27,58,.50);
    }
    .game-title::after{
      content:'';
      position:absolute;
      bottom:-10px;left:0;width:100%;height:3px;
      background:linear-gradient(90deg,transparent,rgba(77,215,250,.90),transparent);
    }

    .rules-modal-overlay{
      display:none;position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(11,27,58,.72);
      z-index:1000;justify-content:center;align-items:center;animation:fadeIn .3s ease-out;
    }
    .rules-modal-content{
      background:rgba(246,248,255,.98);
      padding:40px;border-radius:20px;width:90%;max-width:700px;text-align:center;
      box-shadow:0 24px 60px rgba(11,27,58,.30);
      border:2px solid rgba(108,124,255,.40);
      animation:modalAppear .5s ease-out;
      backdrop-filter:blur(20px);
      max-height:80vh;overflow-y:auto;position:relative;
      color:var(--c7);
    }
    .rules-modal-content::before{content:'â™ª';position:absolute;top:20px;right:20px;font-size:2rem;color:rgba(108,124,255,.45);}
    .rules-title{font-size:2.2rem;margin-bottom:25px;color:var(--c7);font-weight:900;}
    .rules-text{line-height:1.7;font-size:1.2rem;text-align:left;margin-bottom:30px;padding:0 15px;color:var(--c7);}
    .rules-text p{margin-bottom:12px;padding-left:10px;border-left:3px solid var(--c6);color:var(--c7);}
    .rules-countdown{font-size:1.6rem;margin:25px 0;color:var(--c7);font-weight:900;}
    .rules-close-btn{
      background:linear-gradient(145deg,var(--c6),var(--c7));
      color:var(--c5);border:none;padding:12px 35px;border-radius:10px;
      cursor:pointer;font-size:1.2rem;transition:all .3s ease;
      box-shadow:0 8px 20px rgba(11,27,58,.22);
      backdrop-filter:blur(10px);
      border:1px solid rgba(246,248,255,.40);
      font-weight:900;
    }
    .rules-close-btn:hover{transform:scale(1.05);box-shadow:0 10px 26px rgba(11,27,58,.26);}

    @keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
    @keyframes modalAppear{from{opacity:0;transform:scale(.8) translateY(-50px);}to{opacity:1;transform:scale(1) translateY(0);} }

    .game-area{display:flex;flex-direction:column;gap:30px;}

    .player-section{
      background: rgba(12, 22, 45, .24);
      padding:25px;border-radius:15px;
      box-shadow:0 14px 30px rgba(11,27,58,.22);
      backdrop-filter:blur(10px);
      border:1px solid rgba(77,215,250,.22);
      color: rgba(246,248,255,.92);
    }

    .section-title{
      font-size:1.6rem;margin-bottom:15px;
      color: rgba(246,248,255,.95);
      border-bottom:2px solid rgba(77,215,250,.30);
      padding-bottom:8px;
      font-weight:900;
      text-shadow: 0 10px 20px rgba(11,27,58,.40);
    }

    .numbers-container{display:flex;justify-content:center;gap:30px;margin-bottom:20px;flex-wrap:wrap;}

    .number-item{
      background: linear-gradient(145deg, rgba(108,124,255,.58), rgba(12,22,45,.10));
      width:110px;height:110px;border-radius:50%;
      display:flex;align-items:center;justify-content:center;
      font-size:2.8rem;font-weight:900;
      box-shadow:0 16px 30px rgba(11,27,58,.22);
      transition:all .3s ease;
      backdrop-filter:blur(5px);
      border:2px solid rgba(77,215,250,.18);
      color: rgba(246,248,255,.95);
      position:relative;overflow:hidden;
      user-select:none;
    }
    .number-item:hover{transform:translateY(-4px) scale(1.02);}
    .dead{
      opacity:.55;
      background:linear-gradient(145deg,rgba(108,124,255,.22),rgba(12,22,45,.10));
      color:rgba(246,248,255,.45);
    }
    .active{border:3px solid var(--c2);box-shadow:0 0 18px rgba(11,27,58,.18);}

    .opbar{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:12px;
      margin-top:8px;
      padding:14px 16px;
      border-radius:12px;
      background: rgba(12, 22, 45, .20);
      border:1px solid rgba(77,215,250,.18);
      backdrop-filter:blur(10px);
      flex-wrap:wrap;
    }

    .control-btn{
      background:linear-gradient(145deg,rgba(108,124,255,.98),rgba(11,27,58,.98));
      color:var(--c5);
      border:none;
      padding:12px 26px;border-radius:10px;cursor:pointer;font-size:1.2rem;
      transition:all .3s ease;
      backdrop-filter:blur(10px);
      border:1px solid rgba(246,248,255,.45);
      box-shadow:0 10px 22px rgba(11,27,58,.20);
      font-weight:900;
    }
    .control-btn:hover{transform:scale(1.05);box-shadow:0 12px 26px rgba(11,27,58,.24);}
    .control-btn:disabled{
      background:rgba(108,124,255,.35);
      color:rgba(246,248,255,.55);
      cursor:not-allowed;transform:none;box-shadow:none;
      border:1px solid rgba(77,215,250,.14);
    }
    .control-btn-secondary{
      background:linear-gradient(145deg,rgba(77,215,250,.85),rgba(108,124,255,.85));
      color: rgba(246,248,255,.95);
      border:1px solid rgba(246,248,255,.25);
      font-weight:900;
    }
    .control-btn-secondary:hover{transform:scale(1.05);}

    .console{
      background: rgba(12, 22, 45, .26);
      padding:20px;border-radius:15px;margin-top:30px;min-height:120px;
      font-family:'Courier New', monospace;
      white-space:pre-wrap;overflow-y:auto;max-height:200px;
      backdrop-filter:blur(10px);
      border:1px solid rgba(77,215,250,.22);
      color: rgba(246,248,255,.92);
      box-shadow:0 14px 30px rgba(11,27,58,.22);
    }
    .console-title{
      color: rgba(246,248,255,.95);
      margin-bottom:10px;font-size:1.2rem;
      font-weight:900;
    }

    .move-counter{
      text-align:center;font-size:1.3rem;margin-bottom:15px;
      color: rgba(246,248,255,.95);
      background: rgba(12, 22, 45, .28);
      padding:10px;border-radius:10px;display:inline-block;
      position:relative;left:50%;transform:translateX(-50%);
      border:1px solid rgba(77,215,250,.25);
      font-weight:900;
      box-shadow:0 12px 26px rgba(11,27,58,.25);
      backdrop-filter: blur(10px);
    }

    .result-modal-overlay{
      display:none;position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(11,27,58,.78);
      z-index:1001;justify-content:center;align-items:center;
    }
    .result-modal-content{
      background:rgba(246,248,255,.98);
      padding:50px;border-radius:25px;width:90%;max-width:550px;text-align:center;
      box-shadow:0 26px 70px rgba(11,27,58,.32);
      border:2px solid rgba(108,124,255,.40);
      animation:modalAppear .5s ease-out;
      backdrop-filter:blur(20px);
      position:relative;overflow:hidden;
      color:var(--c7);
    }
    .result-modal-content::before{content:'â™ª';position:absolute;top:20px;left:20px;font-size:2rem;color:rgba(108,124,255,.45);}
    .result-modal-content::after{content:'â™ª';position:absolute;bottom:20px;right:20px;font-size:2rem;color:rgba(108,124,255,.45);}
    .result-title{font-size:2.8rem;margin-bottom:20px;color:var(--c7);font-weight:900;}
    .result-message{
      font-size:1.4rem;line-height:1.6;margin-bottom:30px;
      white-space:pre-line;color:var(--c7);
      padding:15px;background:rgba(255,209,102,.18);
      border-radius:10px;border:1px solid rgba(11,27,58,.10);
      font-weight:800;
    }
    .result-btn{
      background:linear-gradient(145deg,var(--c6),var(--c7));
      color:var(--c5);border:none;padding:15px 40px;border-radius:10px;
      cursor:pointer;font-size:1.2rem;transition:all .3s ease;margin:10px;
      backdrop-filter:blur(10px);
      border:1px solid rgba(246,248,255,.45);
      box-shadow:0 10px 22px rgba(11,27,58,.20);
      font-weight:900;
    }
    .result-btn:hover{transform:scale(1.05);box-shadow:0 12px 26px rgba(11,27,58,.24);}
    .result-btn-exit{background:linear-gradient(145deg,var(--c7),var(--c6));}
    .result-icon{font-size:5rem;margin-bottom:20px;animation:bounce 1s infinite alternate;color:var(--c2);}
    @keyframes bounce{from{transform:translateY(0);}to{transform:translateY(-20px);} }

    .stone-board{display:flex;flex-direction:column;gap:18px;}
    .piles-row{display:flex;flex-wrap:wrap;justify-content:center;gap:14px;}

    .pile-box{
      width:160px;min-height:140px;padding:12px;border-radius:16px;
      background: rgba(12, 22, 45, .22);
      border:1px solid rgba(77,215,250,.18);
      backdrop-filter:blur(10px);
      box-shadow:0 10px 22px rgba(11,27,58,.14);
      display:flex;flex-direction:column;gap:10px;
      color: rgba(246,248,255,.92);
    }
    .pile-header{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      color: rgba(246,248,255,.92);
      font-weight:900;font-size:1.05rem;
    }
    .pile-count-badge{
      padding:4px 10px;border-radius:999px;
      background: rgba(77,215,250,.14);
      border:1px solid rgba(77,215,250,.18);
      color: rgba(246,248,255,.92);
      font-weight:900;font-size:.95rem;
    }
    .pile-stones{
      display:flex;flex-wrap:wrap;gap:8px;
      justify-content:flex-start;align-content:flex-start;
      min-height:88px;
    }

    /* âœ… çŸ³å­é¢œè‰²æ”¹ä¸º #a9a9a9ï¼ˆå¸¦ä¸€ç‚¹ç«‹ä½“æ„Ÿï¼‰ */
    .stone{
      width:28px;height:22px;border-radius:999px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), rgba(255,255,255,0) 58%),
        linear-gradient(145deg, #c7c7c7, #8f8f8f);
      box-shadow:
        inset 0 -2px 4px rgba(0,0,0,.22),
        0 8px 16px rgba(11,27,58,.20);
      border:1px solid rgba(0,0,0,.12);
      cursor:grab;
      user-select:none;
    }
    .stone:active{cursor:grabbing;}
    .stone.disabled{opacity:.45;cursor:not-allowed;filter:saturate(.7);}

    .fly{
      position:fixed;
      z-index:2000;
      pointer-events:none;
      transition:transform .24s ease-in-out, opacity .24s ease-in-out;
      will-change:transform, opacity;
    }

    .ground{
      width:100%;
      min-height:120px;
      border-radius:18px;
      background: rgba(12, 22, 45, .22);
      border:2px dashed rgba(77,215,250,.28);
      backdrop-filter:blur(10px);
      padding:14px;
      display:flex;flex-wrap:wrap;gap:10px;
      justify-content:flex-start;align-content:flex-start;
      position:relative;
      color: rgba(246,248,255,.92);
      box-shadow:0 10px 22px rgba(11,27,58,.14);
    }
    .ground::before{
      content:'ç©ºåœ°';
      position:absolute;
      top:10px;right:12px;
      font-weight:900;
      color: rgba(246,248,255,.90);
      letter-spacing:.1em;
    }

    @media(max-width:768px){
      h1{font-size:2.5rem;}
      .luotianyi-quote{font-size:1.2rem;}
      .game-selector{flex-direction:column;align-items:center;gap:20px;}
      .game-btn{width:100%;max-width:300px;padding:20px 30px;font-size:1.4rem;}
      .numbers-container{gap:15px;}
      .number-item{width:90px;height:90px;font-size:2.2rem;}
      .rules-modal-content,.result-modal-content{padding:20px;width:95%;}
      .rules-title{font-size:1.8rem;}
      .result-title{font-size:2.2rem;}
      .result-message{font-size:1.2rem;}
      .pile-box{width:46%; min-width:150px;}
    }
  </style>
</head>

<body>
  <div id="snowflakes"></div>

  <div class="rules-modal-overlay" id="rulesModal">
    <div class="rules-modal-content">
      <h2 class="rules-title" id="rulesTitle">æ¸¸æˆè§„åˆ™</h2>
      <div class="rules-text" id="rulesText"></div>
      <div class="rules-countdown" id="rulesCountdown">çª—å£å°†åœ¨15ç§’åè‡ªåŠ¨å…³é—­</div>
      <button class="rules-close-btn" id="rulesCloseBtn">å…³é—­è§„åˆ™è¯´æ˜</button>
    </div>
  </div>

  <div class="result-modal-overlay" id="resultModal">
    <div class="result-modal-content">
      <div class="result-icon" id="resultIcon">ğŸ‰</div>
      <h2 class="result-title" id="resultTitle">æ¸¸æˆç»“æŸ</h2>
      <div class="result-message" id="resultMessage"></div>
      <div>
        <button class="result-btn" id="resultRestartBtn">é‡æ–°å¼€å§‹</button>
        <button class="result-btn result-btn-exit" id="resultExitBtn">é€€å‡ºæ¸¸æˆ</button>
      </div>
    </div>
  </div>

  <div class="result-modal-overlay" id="alertModal" style="z-index:1002;">
    <div class="result-modal-content">
      <div class="result-icon" id="alertIcon">âš ï¸</div>
      <h2 class="result-title" id="alertTitle">æé†’</h2>
      <div class="result-message" id="alertMessage"></div>
      <div>
        <button class="result-btn" id="alertOkBtn">çŸ¥é“äº†</button>
      </div>
    </div>
  </div>

  <!-- âœ… 40å›åˆé€‰æ‹©å¼¹çª—ï¼ˆæŒ‰C++ï¼‰ -->
  <div class="result-modal-overlay" id="round40Modal" style="z-index:1003; display:none;">
    <div class="result-modal-content">
      <div class="result-icon">ğŸ•’</div>
      <h2 class="result-title" id="round40Title">æç¤º</h2>
      <div class="result-message" id="round40Message"></div>
      <div>
        <button class="result-btn" id="round40DrawBtn">114514 å’Œæ£‹</button>
        <button class="result-btn result-btn-exit" id="round40ContinueBtn">1919810 ç»§ç»­</button>
      </div>
    </div>
  </div>

  <div class="container">
    <header>
      <h1>My Game</h1>
      <div class="luotianyi-quote">åé£å¤éŸµï¼Œæ´›æ°´å¤©ä¾</div>
    </header>

    <div class="game-selector">
      <button class="game-btn" id="game1Btn">
        <div class="game-icon">ğŸ”¢</div>
        <div>1+1 æ•°å­—æ¸¸æˆ</div>
      </button>
      <button class="game-btn" id="game2Btn">
        <div class="game-icon">ğŸª¨</div>
        <div>æ‹¿çŸ³å­æ¸¸æˆ</div>
      </button>
    </div>

    <div class="game-container" id="game1Container">
      <h2 class="game-title">1+1 æ•°å­—æ¸¸æˆ</h2>
      <div class="move-counter" id="moveCounter1">æ­¥æ•°: 0 | è¿ä¾‹æ¬¡æ•°: 0</div>

      <div class="game-area">
        <div class="player-section">
          <h3 class="section-title">ä½ çš„æ•°å­—</h3>
          <div class="numbers-container">
            <div class="number-item" id="playerNum1">1</div>
            <div class="number-item" id="playerNum2">1</div>
          </div>

          <h3 class="section-title">ç”µè„‘çš„æ•°å­—</h3>
          <div class="numbers-container">
            <div class="number-item" id="opponentNum1">1</div>
            <div class="number-item" id="opponentNum2">1</div>
          </div>

          <div class="opbar">
            <button class="control-btn" id="makeMoveBtn" disabled>æ‰§è¡Œæ“ä½œ</button>
          </div>
        </div>

        <div class="console">
          <div class="console-title">æ¸¸æˆæ§åˆ¶å°</div>
          <div id="game1Console">ç­‰å¾…æ¸¸æˆå¼€å§‹...</div>
        </div>
      </div>
    </div>

    <div class="game-container" id="game2Container">
      <h2 class="game-title">æ‹¿çŸ³å­æ¸¸æˆ</h2>

      <div class="game-area">
        <div class="player-section">
          <h3 class="section-title">çŸ³å­å †</h3>

          <div class="stone-board">
            <div class="piles-row" id="pilesRow"></div>
            <div class="ground" id="ground"></div>

            <div class="opbar" style="margin-top:10px;">
              <button class="control-btn control-btn-secondary" id="resetStonesBtn" disabled>é‡ç½®</button>
              <button class="control-btn" id="takeStonesBtn" disabled>æ‰§è¡Œæ“ä½œ</button>
            </div>
          </div>
        </div>

        <div class="console">
          <div class="console-title">æ¸¸æˆæ§åˆ¶å°</div>
          <div id="game2Console">ç­‰å¾…æ¸¸æˆå¼€å§‹...</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const PILE_COUNT = 6;

    let currentGame=null;
    let rulesTimer=null;
    let rulesTimeLeft=15;
    let game1Active=false;
    let game2Active=false;

    // âœ… æŒ‰C++æ‰©å±•å­—æ®µï¼šroundCnt(å›åˆcnt)ã€jujueã€vis
    let game1State={
      playerNums:[1,1],
      opponentNums:[1,1],
      playerTurn:true,
      gameOver:false,
      moveCount:0,   // UIæ­¥æ•°ï¼ˆç©å®¶+ç”µè„‘çš„åŠ¨ä½œæ¬¡æ•°ï¼‰
      against:0,
      roundCnt:0,    // C++ cntï¼šæ¯å®Œæˆâ€œä½ +ç”µè„‘â€ç®—1å›åˆï¼ˆåœ¨ç”µè„‘èµ°å®Œå+1ï¼‰
      jujue:0,       // C++ jujue
      vis:Array.from({length:10},()=>Array(10).fill(false)) // C++ vis
    };

    let pick={playerIdx:null,oppIdx:null};

    let game2State={
      piles:[],
      playerTurn:true,
      gameOver:false,
      violationCount:0,
      pending:{pile:null,count:0},
      aiBusy:false
    };

    const res=[
      [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
      [-1,1,0,0.5,0,0,1,1,0.5,1],
      [-1,0.5,1,1,0,1,0.5,0,1,0],
      [-1,1,0,1,0.5,0,0,1,1,0.5],
      [-1,1,0.5,0,1,1,1,0.5,0,0],
      [-1,0,1,0,1,1,1,0,1,0],
      [-1,0,0,0.5,1,1,1,0,0.5,1],
      [-1,0.5,1,1,0,0,0.5,1,0,1],
      [-1,0,1,0,0.5,1,0,1,1,0.5],
      [-1,1,0.5,1,1,0,0,0.5,0,1]
    ];

    function dfs(cnt,a,b,c,lc){
      if(c===0) return 0; // åªæœ‰ä¸€åªæ‰‹çš„ä¸€æ–¹èµ¢

      if((b===0 && res[c][a]===1) || (a===0 && res[c][b]===1)) return 0;
      if((b===0 && res[c][a]===0) || (a===0 && res[c][b]===0)) return 1;
      if((b===0 && res[c][a]===0.5) || (a===0 && res[c][b]===0.5)) return 0.5;

      if(cnt===25) return 0.5;

      if(lc===0){
        const ans1=dfs(cnt+1,a,b,(c+a)%10,1);
        const ans2=dfs(cnt+1,a,b,(c+b)%10,1);
        if(ans1===1 && ans2===1) return 1;
        else if(ans1===0 || ans2===0) return 0;
        else return 0.5;
      }else{
        const ans1=dfs(cnt+1,(c+a)%10,b,c,0);
        const ans2=dfs(cnt+1,a,(c+b)%10,c,0);
        if(ans1===0 && ans2===0) return 0;
        else if(ans1===1 || ans2===1) return 1;
        else return 0.5;
      }
    }

    // âœ… ä¸¥æ ¼æŒ‰ä½ ç»™çš„â€œç¬¬äºŒç‰ˆC++â€é‡å†™ç”µè„‘é€»è¾‘ï¼ˆå«ç¼ºå¤±åˆ†æ”¯ & visåˆ¤å’Œï¼‰
    function computerAI(){
      const player=game1State.playerNums;      // [0],[1] <=> C++ player[1],[2]
      const computer=game1State.opponentNums;  // [0],[1] <=> C++ computer[1],[2]

      if((player[0]===0 && player[1]===0) || (computer[0]===0 && computer[1]===0)) return false;

      // å››æ‰‹éƒ½åœ¨åœº
      if(player[0]!==0 && player[1]!==0 && computer[0]!==0 && computer[1]!==0){
        let flag=0;
        const random_number=Math.floor(Math.random()*2);

        // â‘  å…ˆæ‰¾ computer[i]+player[j]==10
        for(let i=1;i<=2;i++){
          for(let j=2;j>=1;j--){
            if(flag) break;
            if(computer[i-1] + player[j-1] === 10){
              const otheri=(i===1)?2:1;
              const otherj=(j===1)?2:1;

              if(dfs(0, player[j-1], player[otherj-1], computer[otheri-1], 1) < 1){
                computer[i-1]=(computer[i-1]+player[j-1])%10;
                flag=1;
              }else{
                computer[i-1]=(computer[i-1]+player[otherj-1])%10;
                flag=1;
              }
            }
          }
        }

        // â‘¡ randomåˆ†æ”¯ï¼šæ‰¾qï¼Œå¹¶æŒ‰ bo/dfs åˆ¤
        if(!flag){
          if(random_number){
            for(let i=1;i<=2;i++){
              for(let j=1;j<=2;j++){
                if(flag) break;

                const otheri=(i===1)?2:1;
                const q=(computer[i-1]+player[j-1])%10;

                let bo=0;
                for(let px=1;px<=2;px++){
                  if(player[px-1]===0) continue;
                  if(flag) continue;
                  if(player[px-1] + q === 10){
                    const opx=(px===1)?2:1;
                    if(dfs(0, player[otheri-1], q, computer[opx-1], 1) > 0){
                      computer[i-1]=q; flag=1;
                    }
                    bo=1;
                  }
                }
                if(!bo){
                  computer[i-1]=q; flag=1;
                }
              }
            }
          }else{
            for(let i=2;i>=1;i--){
              for(let j=2;j>=1;j--){
                if(flag) break;

                const otheri=(i===1)?2:1;
                const q=(computer[i-1]+player[j-1])%10;

                let bo=0;
                for(let px=1;px<=2;px++){
                  if(player[px-1]===0) continue;
                  if(flag) continue;
                  if(player[px-1] + q === 10){
                    const opx=(px===1)?2:1;
                    if(dfs(0, player[opx-1], q, computer[otheri-1], 1) > 0){
                      computer[i-1]=q; flag=1;
                    }
                    bo=1;
                  }
                }
                if(!bo){
                  computer[i-1]=q; flag=1;
                }
              }
            }
          }
        }

        // â‘¢ è¿˜æ²¡èµ°ï¼šæ‰¾ä¸€ä¸ªè®©ä¸¤æ‰‹ä¸ç›¸ç­‰çš„å˜åŒ–
        if(!flag){
          if(random_number){
            for(let i=1;i<=2;i++){
              for(let j=1;j<=2;j++){
                if(flag) break;
                const otheri=(i===1)?2:1;
                if((computer[i-1]+player[j-1])%10 !== computer[otheri-1]){
                  computer[i-1]=(computer[i-1]+player[j-1])%10;
                  flag=1;
                }
              }
            }
          }else{
            for(let i=2;i>=1;i--){
              for(let j=2;j>=1;j--){
                if(flag) break;
                const otheri=(i===1)?2:1;
                if((computer[i-1]+player[j-1])%10 !== computer[otheri-1]){
                  computer[i-1]=(computer[i-1]+player[j-1])%10;
                  flag=1;
                }
              }
            }
          }
        }

        // â‘£ å…œåº•ï¼šcomputer[1]+=player[2]
        if(!flag){
          computer[0]=(computer[0]+player[1])%10;
        }
      }
      // ç©å®¶åªå‰©ä¸€åªæ‰‹ï¼Œç”µè„‘ä¸¤åªæ‰‹
      else if((player[0]===0 || player[1]===0) && computer[0]!==0 && computer[1]!==0){
        const x=(player[0]===0)?2:1;
        if(dfs(0,(computer[0]+player[x-1])%10,computer[1],player[x-1],0)){
          computer[0]=(computer[0]+player[x-1])%10;
        }else{
          computer[1]=(computer[1]+player[x-1])%10;
        }
      }
      // âœ… ç©å®¶ä¸¤åªæ‰‹ï¼Œç”µè„‘åªå‰©ä¸€åªæ‰‹ï¼ˆåŸJSç¼ºå¤±åˆ†æ”¯ï¼‰
      else if(player[0]!==0 && player[1]!==0 && (computer[0]===0 || computer[1]===0)){
        const Alive=(computer[0]===0)?2:1;
        if(dfs(0, player[0], player[1], (computer[Alive-1]+player[0])%10, 1) < 1){
          computer[Alive-1]=(computer[Alive-1]+player[0])%10;
        }else{
          computer[Alive-1]=(computer[Alive-1]+player[1])%10;
        }
      }
      // åŒæ–¹éƒ½åªå‰©ä¸€åªæ‰‹ï¼švisåˆ¤å’Œ
      else{
        const x=(player[0]===0)?2:1;
        const y=(computer[0]===0)?2:1;

        const pv=player[x-1];
        const cv=computer[y-1];

        if(game1State.vis[pv][cv]){
          showResultModal('draw','å¹³å±€','game1');
          return false;
        }
        game1State.vis[pv][cv]=true;

        computer[y-1]=(computer[y-1]+player[x-1])%10;

        const cv2=computer[y-1];
        if(game1State.vis[pv][cv2]){
          showResultModal('draw','å¹³å±€','game1');
          return false;
        }
        game1State.vis[pv][cv2]=true;
      }

      return true;
    }

    function getRand(l,r){return Math.floor(Math.random()*(r-l+1))+l;}
    function empty(a){for(let i=0;i<PILE_COUNT;i++) if(a[i]>0) return false; return true;}
    function getxor(a){let x=0; for(let i=0;i<PILE_COUNT;i++) x^=a[i]; return x;}

    function generateStoneArray(){
      const s=new Array(PILE_COUNT).fill(0);
      for(let i=0;i<PILE_COUNT;i++){
        s[i]=getRand(1,7);
      }
      let X=0;
      for(let i=0;i<PILE_COUNT;i++) X^=s[i];
      if(X===0){
        if(s[0]>1) s[0]--; else s[0]++;
      }
      return s;
    }

    function nimChoose(a){
      const X=getxor(a);
      if(X===0){
        const ne=[]; for(let i=0;i<PILE_COUNT;i++) if(a[i]>0) ne.push(i);
        const pile=ne[Math.floor(Math.random()*ne.length)];
        return {pile, take:getRand(1,a[pile])};
      }
      for(let i=0;i<PILE_COUNT;i++){
        const target=(a[i]^X);
        if(target<a[i]) return {pile:i, take:a[i]-target};
      }
      for(let i=0;i<PILE_COUNT;i++) if(a[i]>0) return {pile:i, take:1};
      return {pile:0, take:1};
    }

    const game1Btn=document.getElementById('game1Btn');
    const game2Btn=document.getElementById('game2Btn');
    const game1Container=document.getElementById('game1Container');
    const game2Container=document.getElementById('game2Container');
    const makeMoveBtn=document.getElementById('makeMoveBtn');
    const game1Console=document.getElementById('game1Console');
    const game2Console=document.getElementById('game2Console');
    const takeStonesBtn=document.getElementById('takeStonesBtn');
    const resetStonesBtn=document.getElementById('resetStonesBtn');
    const moveCounter1=document.getElementById('moveCounter1');

    const rulesModal=document.getElementById('rulesModal');
    const rulesTitle=document.getElementById('rulesTitle');
    const rulesText=document.getElementById('rulesText');
    const rulesCountdown=document.getElementById('rulesCountdown');
    const rulesCloseBtn=document.getElementById('rulesCloseBtn');

    const resultModal=document.getElementById('resultModal');
    const resultMessage=document.getElementById('resultMessage');
    const resultIcon=document.getElementById('resultIcon');
    const resultRestartBtn=document.getElementById('resultRestartBtn');
    const resultExitBtn=document.getElementById('resultExitBtn');

    const alertModal=document.getElementById('alertModal');
    const alertTitle=document.getElementById('alertTitle');
    const alertMessage=document.getElementById('alertMessage');
    const alertIcon=document.getElementById('alertIcon');
    const alertOkBtn=document.getElementById('alertOkBtn');

    // âœ… 40å›åˆå¼¹çª—
    const round40Modal=document.getElementById('round40Modal');
    const round40Title=document.getElementById('round40Title');
    const round40Message=document.getElementById('round40Message');
    const round40DrawBtn=document.getElementById('round40DrawBtn');
    const round40ContinueBtn=document.getElementById('round40ContinueBtn');

    const pilesRow=document.getElementById('pilesRow');
    const ground=document.getElementById('ground');

    function showAlertModal(title, message, icon='âš ï¸'){
      alertIcon.textContent=icon;
      alertTitle.textContent=title;
      alertMessage.textContent=message;
      alertModal.style.display='flex';
    }
    function closeAlertModal(){alertModal.style.display='none';}
    alertOkBtn.addEventListener('click', closeAlertModal);
    alertModal.addEventListener('click',(e)=>{if(e.target===alertModal) closeAlertModal();});

    function showResultModal(result,message,game){
      if(game==='game1'){game1State.gameOver=true;game1Active=false;makeMoveBtn.disabled=true;}
      else{game2State.gameOver=true;game2Active=false;takeStonesBtn.disabled=true;resetStonesBtn.disabled=true;}

      resultIcon.textContent = (result==='win')?'ğŸ†':(result==='lose')?'ğŸ’”':'ğŸ¤';
      resultMessage.textContent=message;
      resultModal.style.display='flex';
      if(game==='game1') game1Console.textContent+=`\n${message}`;
      else game2Console.textContent+=`\n${message}`;
    }

    // âœ… 40å›åˆé€‰æ‹©é€»è¾‘ï¼ˆä¸¥æ ¼æŒ‰C++å°è¯ï¼‰
    function openRound40Modal(){
      round40Modal.style.display='flex';
      round40Title.textContent='æç¤º';
      if(game1State.jujue===0){
        round40Message.textContent='ä¸‹äº†40ä¸ªå›åˆï¼Œæ‚¨ä¸ç´¯å—\nè¾“å‡º 114514 åˆ™ä¸ºå’Œæ£‹ï¼Œè¾“å‡º 1919810 åˆ™ç»§ç»­ä¸‹';
      }else{
        round40Message.textContent='åˆä¸‹äº†40ä¸ªå›åˆï¼Œæ‚¨ä¸ç´¯å—\nè¾“å‡º 114514 åˆ™ä¸ºå’Œæ£‹ï¼Œè¾“å‡º 1919810 åˆ™ç»§ç»­ä¸‹';
      }
    }
    function closeRound40Modal(){ round40Modal.style.display='none'; }

    round40DrawBtn.addEventListener('click',()=>{
      closeRound40Modal();
      showResultModal('draw','å¹³å±€','game1');
    });

    round40ContinueBtn.addEventListener('click',()=>{
      closeRound40Modal();
      game1State.roundCnt=0;
      game1State.jujue++;

      if(game1State.jujue===1){
        game1Console.textContent += '\nä¸–ç•Œä¸Šåªæœ‰ä¸€ç§è‹±é›„ä¸»ä¹‰ï¼Œé‚£å°±æ˜¯åœ¨çœ‹æ¸…æ¸¸æˆçš„çœŸç›¸åï¼Œä»ç„¶çƒ­çˆ±æ¸¸æˆ\n Come on! ç»§ç»­ç©ä¸‹å»å§\n';
      }else{
        game1Console.textContent += `\næ‚¨å·²ç»æ‹’ç»${game1State.jujue-1}æ¬¡äº†\næ‚¨ç®€ç›´å°±æ˜¯ä¸€å—ä¼šè¯´è¯çš„é’¢æ¿ï¼\nç»§ç»­ç©ä¸‹å»å§\n`;
      }
      updateGame1Display();
      game1State.playerTurn=true;
      updateMakeMoveEnabled();
    });

    // ç‚¹é®ç½©å…³é—­ï¼šæŒ‰C++â€œè°ƒçš®â€+ è¿ä¾‹
    round40Modal.addEventListener('click',(e)=>{
      if(e.target!==round40Modal) return;
      closeRound40Modal();
      game1State.against++;
      game1Console.textContent += '\nè°ƒçš®\nè¿ä¾‹äº†å“¦ï¼Œå†æœ‰ä¸€æ¬¡åˆ¤ä½ è¾“ä¿¡ä¸ä¿¡^-^';
      updateGame1Display();
      if(game1State.against>=2){
        showResultModal('lose','ä½ è¾“äº†ï¼Œä¸å¬è¯çš„å­©å­è¦å—åˆ°æƒ©ç½š^-^','game1');
      }else{
        game1State.playerTurn=true;
        updateMakeMoveEnabled();
      }
    });

    game1Btn.addEventListener('click',()=>{showGame('game1');showRules('game1');});
    game2Btn.addEventListener('click',()=>{showGame('game2');showRules('game2');});
    rulesCloseBtn.addEventListener('click',closeRules);

    resultRestartBtn.addEventListener('click',()=>{
      resultModal.style.display='none';
      if(currentGame==='game1') startGame1(); else startGame2();
    });
    resultExitBtn.addEventListener('click',()=>{
      resultModal.style.display='none';
      if(currentGame==='game1') game1Container.style.display='none';
      else game2Container.style.display='none';
      currentGame=null;
    });

    function showGame(game){
      currentGame=game;
      game1Container.style.display='none';
      game2Container.style.display='none';
      if(game==='game1') game1Container.style.display='block';
      else game2Container.style.display='block';
    }

    function showRules(game){
      if(game==='game1'){
        rulesTitle.textContent='1+1 æ¸¸æˆè§„åˆ™';
        rulesText.innerHTML=`
          <p>1. åˆå§‹åŒæ–¹åˆ†åˆ«æœ‰ä¸¤ä¸ªæ•°å­—1</p>
          <p>2. åŒæ–¹è½®æµæ“ä½œï¼šé€‰æ‹©è‡ªå·±ä»»æ„ä¸€ä¸ªæ•°å­— + å¯¹æ–¹ä»»æ„ä¸€ä¸ªæ•°å­—ï¼Œç„¶åå–ä¸ªä½æ•°</p>
          <p>3. æ•°å­—åœ¨åœºï¼šè¯¥æ•°å­—ä¸ç­‰äºé›¶</p>
          <p>4. å…ˆè®©è‡ªå·±ä¸¤ä¸ªæ•°å­—å‡ä¸åœ¨åœºçš„ä¸€æ–¹è·èƒœ</p>
          <p>5. ä¸‹æ»¡40å›åˆä¼šæç¤ºæ˜¯å¦å’Œæ£‹/ç»§ç»­</p>
          <p>6. è¿ä¾‹2æ¬¡ç›´æ¥åˆ¤è´Ÿ</p>
        `;
        startGame1();
      }else{
        rulesTitle.textContent='æ‹¿çŸ³å­æ¸¸æˆè§„åˆ™';
        rulesText.innerHTML=`
          <p>1. åœ°ä¸Šæœ‰6å †çŸ³å­ï¼Œåˆå§‹æ¯å †çŸ³å­æ•°é‡éšæœº(1-7)</p>
          <p>2. æ¯äººæ¯æ¬¡å¯ä»ä»»æ„ä¸€å †çŸ³å­é‡Œå–å‡ºä»»æ„å¤šæšçŸ³å­æ‰”æ‰</p>
          <p>3. å¯ä»¥å–å®Œï¼Œä¸èƒ½ä¸å–</p>
          <p>4. æ¯æ¬¡åªèƒ½ä»ä¸€å †é‡Œå–</p>
          <p>5. æœ€åæ²¡çŸ³å­å¯å–çš„äººå°±è¾“äº†</p>
          <p>6. è¿ä¾‹2æ¬¡ç›´æ¥åˆ¤è´Ÿ</p>
        `;
        startGame2();
      }

      rulesModal.style.display='flex';
      rulesTimeLeft=15;
      rulesCountdown.textContent=`çª—å£å°†åœ¨${rulesTimeLeft}ç§’åè‡ªåŠ¨å…³é—­`;
      if(rulesTimer) clearInterval(rulesTimer);
      rulesTimer=setInterval(()=>{
        rulesTimeLeft--;
        rulesCountdown.textContent=`çª—å£å°†åœ¨${rulesTimeLeft}ç§’åè‡ªåŠ¨å…³é—­`;
        if(rulesTimeLeft<=0) closeRules();
      },1000);
    }
    function closeRules(){
      rulesModal.style.display='none';
      if(rulesTimer){clearInterval(rulesTimer);rulesTimer=null;}
    }

    // ===== 1+1 =====
    function clearPick(){
      pick.playerIdx=null; pick.oppIdx=null;
      ['playerNum1','playerNum2','opponentNum1','opponentNum2'].forEach(id=>document.getElementById(id).classList.remove('active'));
      makeMoveBtn.disabled=true;
    }
    function updateMakeMoveEnabled(){
      const ok=(pick.playerIdx!==null && pick.oppIdx!==null
        && game1State.playerNums[pick.playerIdx]!==0
        && game1State.opponentNums[pick.oppIdx]!==0);
      makeMoveBtn.disabled=!(ok && game1Active && game1State.playerTurn && !game1State.gameOver);
    }

    function bindGame1Clicks(){
      const p1=document.getElementById('playerNum1');
      const p2=document.getElementById('playerNum2');
      const o1=document.getElementById('opponentNum1');
      const o2=document.getElementById('opponentNum2');

      function pickPlayer(idx){
        if(!game1Active || !game1State.playerTurn || game1State.gameOver) return;
        if(game1State.playerNums[idx]===0) return;
        document.getElementById('playerNum1').classList.toggle('active',idx===0);
        document.getElementById('playerNum2').classList.toggle('active',idx===1);
        pick.playerIdx=idx;
        updateMakeMoveEnabled();
      }
      function pickOpp(idx){
        if(!game1Active || !game1State.playerTurn || game1State.gameOver) return;
        if(game1State.opponentNums[idx]===0) return;
        document.getElementById('opponentNum1').classList.toggle('active',idx===0);
        document.getElementById('opponentNum2').classList.toggle('active',idx===1);
        pick.oppIdx=idx;
        updateMakeMoveEnabled();
      }

      p1.addEventListener('click',()=>pickPlayer(0));
      p2.addEventListener('click',()=>pickPlayer(1));
      o1.addEventListener('click',()=>pickOpp(0));
      o2.addEventListener('click',()=>pickOpp(1));
    }

    function updateNumberStatus(id,val){
      const el=document.getElementById(id);
      if(val===0) el.classList.add('dead'); else el.classList.remove('dead');
    }
    function updateGame1Display(){
      document.getElementById('playerNum1').textContent=game1State.playerNums[0];
      document.getElementById('playerNum2').textContent=game1State.playerNums[1];
      document.getElementById('opponentNum1').textContent=game1State.opponentNums[0];
      document.getElementById('opponentNum2').textContent=game1State.opponentNums[1];

      updateNumberStatus('playerNum1',game1State.playerNums[0]);
      updateNumberStatus('playerNum2',game1State.playerNums[1]);
      updateNumberStatus('opponentNum1',game1State.opponentNums[0]);
      updateNumberStatus('opponentNum2',game1State.opponentNums[1]);

      moveCounter1.textContent=`æ­¥æ•°: ${game1State.moveCount} | å›åˆ: ${game1State.roundCnt} | æ‹’ç»: ${game1State.jujue} | è¿ä¾‹: ${game1State.against}`;
      updateMakeMoveEnabled();
    }

    function startGame1(){
      game1State={
        playerNums:[1,1],
        opponentNums:[1,1],
        playerTurn:true,
        gameOver:false,
        moveCount:0,
        against:0,
        roundCnt:0,
        jujue:0,
        vis:Array.from({length:10},()=>Array(10).fill(false))
      };
      game1Active=true;
      clearPick();
      updateGame1Display();
      game1Console.textContent=
`æ¸¸æˆå¼€å§‹ï¼åˆå§‹çŠ¶æ€ï¼š
ä½ çš„æ•°å­—ï¼š${game1State.playerNums[0]} ${game1State.playerNums[1]}
ç”µè„‘çš„æ•°å­—ï¼š${game1State.opponentNums[0]} ${game1State.opponentNums[1]}
è½®åˆ°ä½ æ“ä½œäº†ï¼`;
    }

    // âœ… èƒœè´Ÿä¸¥æ ¼æŒ‰C++ï¼šplayerå…¨0 => ç©å®¶èƒœï¼›computerå…¨0 => ç©å®¶è´Ÿ
    function checkGame1Over(){
      const playerAllDead=(game1State.playerNums[0]===0 && game1State.playerNums[1]===0);
      const oppAllDead=(game1State.opponentNums[0]===0 && game1State.opponentNums[1]===0);

      if(playerAllDead){
        showResultModal('win','æˆ‘è¿˜ä¼šå†å›æ¥çš„\næ­å–œä½ ï¼Œå¿«ç‚¹æˆªå±æ‰¾hycé¢†2å—é’±å§','game1');
        return true;
      }
      if(oppAllDead){
        showResultModal('lose','å¤§äººï¼Œæ—¶ä»£å˜äº†','game1');
        return true;
      }
      return false;
    }

    makeMoveBtn.addEventListener('click',()=>{
      if(!game1Active || !game1State.playerTurn || game1State.gameOver) return;

      const pi=pick.playerIdx, oi=pick.oppIdx;

      // å…ˆåˆ¤èŒƒå›´å’Œåˆæ³•ï¼Œå†è®¿é—®æ•°ç»„ï¼ˆå¯¹é½C++é¿å…è¶Šç•Œï¼‰
      const invalid = (pi===null||oi===null||pi<0||pi>1||oi<0||oi>1
        || game1State.playerNums[pi]===0 || game1State.opponentNums[oi]===0);

      if(invalid){
        game1State.against++;
        showAlertModal('è¿ä¾‹æé†’',`è¿ä¾‹äº†å“¦ï¼å†æœ‰ä¸€æ¬¡å°±åˆ¤ä½ è¾“ä¿¡ä¸ä¿¡^-^\nå½“å‰è¿ä¾‹æ¬¡æ•°ï¼š${game1State.against}/2`,'âš ï¸');
        if(game1State.against>=2){
          showResultModal('lose','ä½ è¾“äº†ï¼Œä¸å¬è¯çš„å­©å­è¦å—åˆ°æƒ©ç½š^-^','game1');
          return;
        }
        clearPick(); updateGame1Display(); return;
      }

      // ç©å®¶è½å­
      const result=(game1State.playerNums[pi]+game1State.opponentNums[oi])%10;
      game1State.playerNums[pi]=result;
      game1State.moveCount++;

      game1Console.textContent+=`\nä½ æ“ä½œï¼šä½ çš„æ•°å­—${pi+1} + ç”µè„‘çš„æ•°å­—${oi+1} = ${result}
å½“å‰çŠ¶æ€ï¼š
ä½ çš„æ•°å­—ï¼š${game1State.playerNums[0]} ${game1State.playerNums[1]}
ç”µè„‘çš„æ•°å­—ï¼š${game1State.opponentNums[0]} ${game1State.opponentNums[1]}`;

      clearPick();
      updateGame1Display();

      // âœ… ç©å®¶æ“ä½œåç«‹åˆ»åˆ¤èƒœï¼ˆæŒ‰C++ï¼‰
      if(checkGame1Over()) return;

      // è½®åˆ°ç”µè„‘
      game1State.playerTurn=false;
      makeMoveBtn.disabled=true;
      game1Console.textContent+='\nç”µè„‘æ€è€ƒä¸­...';

      setTimeout(()=>{
        const ok=computerAI();
        if(!ok){
          // computerAIå†…éƒ¨å¯èƒ½è§¦å‘å¹³å±€å¼¹çª—/ç»“æŸ
          if(!game1State.gameOver) checkGame1Over();
          return;
        }

        // ç”µè„‘åŠ¨ä½œè®¡å…¥â€œæ­¥æ•°â€ï¼ˆä½ åŸæœ¬å°±++ï¼Œè¿™é‡Œå¯¹é½ï¼šç”µè„‘ä¹Ÿç®—ä¸€æ¬¡åŠ¨ä½œï¼‰
        game1State.moveCount++;

        updateGame1Display();
        game1Console.textContent+=`\nç”µè„‘æ“ä½œå®Œæˆ
å½“å‰çŠ¶æ€ï¼š
ä½ çš„æ•°å­—ï¼š${game1State.playerNums[0]} ${game1State.playerNums[1]}
ç”µè„‘çš„æ•°å­—ï¼š${game1State.opponentNums[0]} ${game1State.opponentNums[1]}`;

        if(checkGame1Over()) return;

        // âœ… ä¸€è½®ï¼ˆä½ +ç”µè„‘ï¼‰ç»“æŸï¼šå›åˆcnt++
        game1State.roundCnt++;

        // å›åˆ°ç©å®¶å›åˆå‰ï¼Œå…ˆæ£€æŸ¥40å›åˆå¼¹çª—ï¼ˆæŒ‰C++ï¼‰
        game1State.playerTurn=true;

        if(game1State.roundCnt>=40){
          makeMoveBtn.disabled=true;
          game1Console.textContent+='\nï¼ˆå·²è¾¾40å›åˆï¼Œç­‰å¾…ä½ çš„é€‰æ‹©...ï¼‰';
          openRound40Modal();
          return;
        }

        game1Console.textContent+='\nè½®åˆ°ä½ æ“ä½œäº†ï¼';
        updateMakeMoveEnabled();
      },800);
    });

    // ===== æ‹¿çŸ³å­ï¼šé‡ç½®æŒ‰é’®å®ç° =====
    function pendingTotal(){return game2State.pending.count;}
    function pendingPile(){return game2State.pending.pile;}

    function updateTakeBtn(){
      takeStonesBtn.disabled=!(game2Active && game2State.playerTurn && !game2State.gameOver && !game2State.aiBusy && pendingTotal()>0);
      resetStonesBtn.disabled=!(game2Active && game2State.playerTurn && !game2State.gameOver && !game2State.aiBusy && pendingTotal()>0);
    }

    function resetPending(){
      game2State.pending.pile=null;
      game2State.pending.count=0;
      renderGround();
      renderPiles();
      updateTakeBtn();
    }

    function resetThisTurn(){
      if(!game2Active || !game2State.playerTurn || game2State.gameOver || game2State.aiBusy) return;
      if(pendingTotal()<=0) return;
      resetPending();
    }
    resetStonesBtn.addEventListener('click', resetThisTurn);

    function renderGround(){
      ground.innerHTML='';
      for(let i=0;i<game2State.pending.count;i++){
        const s=document.createElement('div');
        s.className='stone';
        ground.appendChild(s);
      }
    }

    function canTakeFromPile(i){
      const used=(pendingPile()===i)?pendingTotal():0;
      return (game2State.piles[i]-used)>0;
    }

    function addOneStoneFromPile(pile){
      if(pendingPile()!==null && pendingPile()!==pile){
        showAlertModal('æé†’','æ¯æ¬¡åªèƒ½ä»ä¸€å †é‡Œå–','âš ï¸');
        return;
      }
      if(!canTakeFromPile(pile)){
        showAlertModal('æé†’','è¿™å †æ²¡æœ‰çŸ³å­äº†','âš ï¸');
        return;
      }
      game2State.pending.pile=pile;
      game2State.pending.count+=1;
      renderGround();
      renderPiles();
      updateTakeBtn();
    }

    function renderPiles(){
      pilesRow.innerHTML='';
      for(let i=0;i<PILE_COUNT;i++){
        const box=document.createElement('div');
        box.className='pile-box';

        const used=(pendingPile()===i)?pendingTotal():0;
        const remain=game2State.piles[i]-used;

        const header=document.createElement('div');
        header.className='pile-header';
        header.innerHTML=`<span>å † ${i+1}</span><span class="pile-count-badge">${remain}</span>`;

        const stones=document.createElement('div');
        stones.className='pile-stones';
        stones.id=`pile-stones-${i}`;

        for(let k=0;k<remain;k++){
          const st=document.createElement('div');
          st.className='stone';

          const enable=(game2Active && game2State.playerTurn && !game2State.gameOver && !game2State.aiBusy);
          st.draggable=enable;
          if(!enable) st.classList.add('disabled');

          st.dataset.pile=String(i);

          st.addEventListener('click',()=>{
            if(!enable) return;
            addOneStoneFromPile(i);
          });

          st.addEventListener('dragstart',(e)=>{
            if(!enable){e.preventDefault();return;}
            e.dataTransfer.setData('text/plain', st.dataset.pile);
          });

          stones.appendChild(st);
        }

        box.appendChild(header);
        box.appendChild(stones);
        pilesRow.appendChild(box);
      }
    }

    function bindGroundDrop(){
      ground.addEventListener('dragover',(e)=>{
        if(!game2Active || !game2State.playerTurn || game2State.gameOver || game2State.aiBusy) return;
        e.preventDefault();
      });
      ground.addEventListener('drop',(e)=>{
        if(!game2Active || !game2State.playerTurn || game2State.gameOver || game2State.aiBusy) return;
        e.preventDefault();
        const pileStr=e.dataTransfer.getData('text/plain');
        const pile=Number(pileStr);
        if(!(pile>=0 && pile<PILE_COUNT)) return;
        addOneStoneFromPile(pile);
      });
    }

    function startGame2(){
      const init=generateStoneArray();
      game2State={
        piles:init,
        playerTurn:true,
        gameOver:false,
        violationCount:0,
        pending:{pile:null,count:0},
        aiBusy:false
      };
      game2Active=true;
      renderGround();
      renderPiles();
      updateTakeBtn();
      game2Console.textContent=`æ¸¸æˆå¼€å§‹ï¼çŸ³å­å †åˆå§‹çŠ¶æ€ï¼š${init.join(' ')}\nè½®åˆ°ä½ æ“ä½œäº†ï¼`;
    }

    function checkGame2AfterPlayer(){
      if(empty(game2State.piles)){
        showResultModal('win','æˆ‘è¿˜ä¼šå†å›æ¥çš„\næ­å–œä½ ï¼Œå¿«ç‚¹æˆªå±æ‰¾hycé¢†2å—é’±å§','game2');
        return true;
      }
      return false;
    }
    function checkGame2AfterAI(){
      if(empty(game2State.piles)){
        showResultModal('lose','å¤§äººï¼Œæ—¶ä»£å˜äº†','game2');
        return true;
      }
      return false;
    }

    takeStonesBtn.addEventListener('click',()=>{
      if(!game2Active || !game2State.playerTurn || game2State.gameOver || game2State.aiBusy) return;

      if(pendingPile()===null || pendingTotal()<=0){
        game2State.violationCount++;
        showAlertModal('è¿ä¾‹æé†’',`è¿ä¾‹äº†å“¦ï¼å†æœ‰ä¸€æ¬¡å°±åˆ¤ä½ è¾“^-^\nå½“å‰è¿ä¾‹æ¬¡æ•°ï¼š${game2State.violationCount}/2`,'âš ï¸');
        if(game2State.violationCount>=2){
          showResultModal('lose','ä½ è¾“äº†ï¼Œä¸å¬è¯çš„å­©å­è¦å—åˆ°æƒ©ç½š^-^','game2');
        }
        return;
      }

      const p=pendingPile();
      const t=pendingTotal();
      game2State.piles[p]-=t;

      game2Console.textContent+=`\nä½ ä»ç¬¬ ${p+1} å †å–å‡ºäº† ${t} ä¸ªçŸ³å­\nå½“å‰çŸ³å­å †ï¼š${game2State.piles.join(' ')}`;

      resetPending();
      if(checkGame2AfterPlayer()) return;

      game2State.playerTurn=false;
      renderPiles();
      updateTakeBtn();
      game2Console.textContent+='\nå¯¹æ‰‹æ€è€ƒä¸­...';

      setTimeout(()=>aiTurn(),600);
    });

    function animateOneDrag(pileIndex){
      return new Promise((resolve)=>{
        const pileEl=document.getElementById(`pile-stones-${pileIndex}`);
        const srcStone=pileEl ? pileEl.querySelector('.stone') : null;
        const groundRect=ground.getBoundingClientRect();

        if(!srcStone){ resolve(); return; }

        const srcRect=srcStone.getBoundingClientRect();

        const fly=document.createElement('div');
        fly.className='stone fly';

        const startX=srcRect.left + srcRect.width/2 - 14;
        const startY=srcRect.top  + srcRect.height/2 - 11;
        fly.style.left=`${startX}px`;
        fly.style.top =`${startY}px`;
        fly.style.transform='translate(0,0) scale(1)';
        document.body.appendChild(fly);

        const colW=38;
        const rowH=32;
        const idx=game2State.pending.count;
        const maxPerRow=Math.max(1, Math.floor((groundRect.width-20)/colW));
        const tx=idx % maxPerRow;
        const ty=Math.floor(idx / maxPerRow);

        const endX=groundRect.left + 14 + tx*colW;
        const endY=groundRect.top  + 28 + ty*rowH;

        const dx=endX - startX;
        const dy=endY - startY;

        requestAnimationFrame(()=>{
          fly.style.transform=`translate(${dx}px, ${dy}px) scale(1.02)`;
          fly.style.opacity='1';
        });

        setTimeout(()=>{
          fly.style.opacity='0.0';
          setTimeout(()=>{ fly.remove(); resolve(); },120);
        },260);
      });
    }

    async function aiTurn(){
      if(game2State.gameOver) return;

      const {pile, take}=nimChoose(game2State.piles);

      game2State.aiBusy=true;
      game2State.pending.pile=pile;
      game2State.pending.count=0;
      renderGround();
      renderPiles();
      updateTakeBtn();

      for(let i=0;i<take;i++){
        if(game2State.gameOver) return;
        await animateOneDrag(pile);
        game2State.pending.count += 1;
        renderGround();
        renderPiles();
      }

      const p=game2State.pending.pile;
      const t=game2State.pending.count;
      game2State.piles[p]-=t;

      game2Console.textContent+=`\nå¯¹æ‰‹ä»ç¬¬ ${p+1} å †å–å‡ºäº† ${t} ä¸ªçŸ³å­\nå½“å‰çŸ³å­å †ï¼š${game2State.piles.join(' ')}`;

      game2State.pending.pile=null;
      game2State.pending.count=0;
      renderGround();
      renderPiles();

      game2State.aiBusy=false;

      if(checkGame2AfterAI()) return;

      game2State.playerTurn=true;
      renderPiles();
      updateTakeBtn();
      game2Console.textContent+='\nè½®åˆ°ä½ æ“ä½œäº†ï¼';
    }

    // ===== é›ªèŠ± =====
    function createSnowflakes(){
      const snowflakesContainer=document.getElementById('snowflakes');
      for(let i=0;i<50;i++){
        const snowflake=document.createElement('div');
        snowflake.classList.add('snowflake');
        const size=Math.random()*10+5;
        snowflake.style.width=`${size}px`;
        snowflake.style.height=`${size}px`;
        snowflake.style.left=`${Math.random()*100}vw`;
        snowflake.style.top=`${Math.random()*100}vh`;
        snowflake.style.opacity=Math.random()*0.7+0.3;
        const duration=Math.random()*10+10;
        const delay=Math.random()*5;
        snowflake.style.animation=`fall ${duration}s linear ${delay}s infinite`;
        snowflakesContainer.appendChild(snowflake);
      }
    }
    const style=document.createElement('style');
    style.textContent=`
      @keyframes fall{
        0%{transform:translateY(-100px) rotate(0deg);}
        100%{transform:translateY(100vh) rotate(360deg);}
      }
    `;
    document.head.appendChild(style);

    function init(){
      game1Container.style.display='none';
      game2Container.style.display='none';
      createSnowflakes();
      bindGame1Clicks();
      bindGroundDrop();
      clearPick();
      updateTakeBtn();
    }
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
