<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Game (Desktop)</title>

  <style>
    :root{
      --c1:#4DD7FA;
      --c2:#FFD166;
      --c3:#F6F8FF;
      --c4:#FFB3C7;
      --c5:#FFFFFF;
      --c6:#6C7CFF;
      --c7:#0B1B3A;
    }

    *{margin:0;padding:0;box-sizing:border-box;font-family:'Microsoft YaHei','Segoe UI',sans-serif;}
    body{
      background:url('https://pic3.zhimg.com/v2-5467960a07a088573ee3fb4cfc90b0c9_r.jpg') no-repeat center center fixed;
      background-size:cover;
      color:var(--c5);
      min-height:100vh;
      padding:20px;
      position:relative;
      overflow-x:hidden;
    }
    body::before{
      content:'';
      position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(11,27,58,.58);
      z-index:-1;
    }

    .snowflake{position:fixed;background-color:rgba(77,215,250,.55);border-radius:50%;pointer-events:none;z-index:1;}
    .container{max-width:1200px;margin:0 auto;padding:20px;position:relative;z-index:2;}

    header{
      text-align:center;margin-bottom:40px;padding:30px;
      background:rgba(12, 22, 45, .22);
      border-radius:20px;
      box-shadow:0 16px 40px rgba(11,27,58,.25);
      backdrop-filter:blur(10px);
      border:1px solid rgba(77,215,250,.22);
      position:relative;overflow:hidden;
    }

    header::before{
      content:'';
      position:absolute;top:0;left:0;width:100%;height:5px;
      background:linear-gradient(90deg, rgba(77,215,250,.95), rgba(108,124,255,.95), rgba(77,215,250,.95));
      background-size:200% 100%;
      animation:blueflow 3.2s linear infinite;
    }
    @keyframes blueflow{0%{background-position:0% 50%;}100%{background-position:200% 50%;}}

    h1{
      font-size:3.5rem;margin-bottom:10px;
      color:var(--c1);
      text-shadow:0 6px 18px rgba(11,27,58,.55);
      font-weight:900;
    }

    .luotianyi-quote{
      font-size:1.4rem;
      color: rgba(246,248,255,.92);
      font-style:italic;
      margin-top:15px;
      padding:10px 14px;
      border-radius:12px;
      background: transparent;
      display:inline-block;
      animation:float 3s ease-in-out infinite;
      border:none;
      text-shadow: 0 8px 18px rgba(11,27,58,.45);
    }
    @keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-10px);} }

    .game-selector{display:flex;justify-content:center;gap:40px;margin-bottom:40px;flex-wrap:wrap;}
    .game-btn{
      background:linear-gradient(145deg,rgba(108,124,255,.95),rgba(77,215,250,.85));
      color:var(--c7);
      border:none;
      padding:25px 40px;font-size:1.6rem;border-radius:15px;cursor:pointer;
      transition:all .3s ease;
      box-shadow:0 14px 34px rgba(11,27,58,.30);
      min-width:220px;
      backdrop-filter:blur(10px);
      border:2px solid rgba(246,248,255,.28);
      position:relative;overflow:hidden;
      font-weight:900;
    }
    .game-btn::before{
      content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;
      background:linear-gradient(90deg,transparent,rgba(246,248,255,.35),transparent);
      transition:.5s;
    }
    .game-btn:hover::before{left:100%;}
    .game-btn:hover{transform:translateY(-8px) scale(1.05);box-shadow:0 18px 40px rgba(11,27,58,.34);}
    .game-btn:active{transform:translateY(-2px);}
    .game-icon{font-size:2.5rem;margin-bottom:10px;color:var(--c2);}

    .game-container{
      display:none;
      background:rgba(246,248,255,.14);
      border-radius:20px;padding:30px;
      box-shadow:0 12px 36px rgba(11,27,58,.26);
      margin-top:20px;
      backdrop-filter:blur(15px);
      border:1px solid rgba(246,248,255,.22);
      position:relative;overflow:hidden;
    }
    .game-container::before{
      content:'';
      position:absolute;top:0;left:0;width:100%;height:5px;
      background:linear-gradient(90deg, rgba(77,215,250,.95), rgba(108,124,255,.95), rgba(77,215,250,.65));
    }

    .game-title{
      text-align:center;font-size:2.5rem;margin-bottom:25px;
      color: rgba(246,248,255,.95);
      position:relative;display:inline-block;left:50%;transform:translateX(-50%);
      background: transparent;
      padding: 0;
      border: none;
      font-weight:900;
      text-shadow: 0 10px 24px rgba(11,27,58,.50);
    }
    .game-title::after{
      content:'';
      position:absolute;
      bottom:-10px;left:0;width:100%;height:3px;
      background:linear-gradient(90deg,transparent,rgba(77,215,250,.90),transparent);
    }

    .rules-modal-overlay,
    .result-modal-overlay{
      display:none;position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(11,27,58,.72);
      z-index:1000;justify-content:center;align-items:center;animation:fadeIn .3s ease-out;
    }
    .result-modal-overlay{z-index:1001;}

    .rules-modal-content,
    .result-modal-content{
      background:rgba(246,248,255,.98);
      padding:40px;border-radius:20px;width:90%;max-width:720px;text-align:center;
      box-shadow:0 24px 60px rgba(11,27,58,.30);
      border:2px solid rgba(108,124,255,.40);
      animation:modalAppear .5s ease-out;
      backdrop-filter:blur(20px);
      max-height:80vh;overflow-y:auto;position:relative;
      color:var(--c7);
    }
    .rules-modal-content::before{content:'â™ª';position:absolute;top:20px;right:20px;font-size:2rem;color:rgba(108,124,255,.45);}
    .rules-title{font-size:2.2rem;margin-bottom:25px;color:var(--c7);font-weight:900;}
    .rules-text{line-height:1.7;font-size:1.2rem;text-align:left;margin-bottom:30px;padding:0 15px;color:var(--c7);}
    .rules-text p{margin-bottom:12px;padding-left:10px;border-left:3px solid var(--c6);color:var(--c7);}
    .rules-countdown{font-size:1.6rem;margin:25px 0;color:var(--c7);font-weight:900;}
    .rules-close-btn{
      background:linear-gradient(145deg,var(--c6),var(--c7));
      color:var(--c5);border:none;padding:12px 35px;border-radius:10px;
      cursor:pointer;font-size:1.2rem;transition:all .3s ease;
      box-shadow:0 8px 20px rgba(11,27,58,.22);
      border:1px solid rgba(246,248,255,.40);
      font-weight:900;
    }
    .rules-close-btn:hover{transform:scale(1.05);box-shadow:0 10px 26px rgba(11,27,58,.26);}

    @keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
    @keyframes modalAppear{from{opacity:0;transform:scale(.8) translateY(-50px);}to{opacity:1;transform:scale(1) translateY(0);} }

    .game-area{display:flex;flex-direction:column;gap:30px;}

    .player-section{
      background: rgba(12, 22, 45, .24);
      padding:25px;border-radius:15px;
      box-shadow:0 14px 30px rgba(11,27,58,.22);
      backdrop-filter:blur(10px);
      border:1px solid rgba(77,215,250,.22);
      color: rgba(246,248,255,.92);
    }

    .section-title{
      font-size:1.6rem;margin-bottom:15px;
      color: rgba(246,248,255,.95);
      border-bottom:2px solid rgba(77,215,250,.30);
      padding-bottom:8px;
      font-weight:900;
      text-shadow: 0 10px 20px rgba(11,27,58,.40);
    }

    .numbers-container{display:flex;justify-content:center;gap:30px;margin-bottom:20px;flex-wrap:wrap;}

    .number-item{
      background: linear-gradient(145deg, rgba(108,124,255,.58), rgba(12,22,45,.10));
      width:110px;height:110px;border-radius:50%;
      display:flex;align-items:center;justify-content:center;
      font-size:2.8rem;font-weight:900;
      box-shadow:0 16px 30px rgba(11,27,58,.22);
      transition:all .3s ease;
      border:2px solid rgba(77,215,250,.18);
      color: rgba(246,248,255,.95);
      user-select:none;
    }
    .number-item:hover{transform:translateY(-4px) scale(1.02);}
    .dead{opacity:.55;background:linear-gradient(145deg,rgba(108,124,255,.22),rgba(12,22,45,.10));color:rgba(246,248,255,.45);}
    .active{border:3px solid var(--c2);}

    .opbar{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:12px;
      margin-top:8px;
      padding:14px 16px;
      border-radius:12px;
      background: rgba(12, 22, 45, .20);
      border:1px solid rgba(77,215,250,.18);
      backdrop-filter:blur(10px);
      flex-wrap:wrap;
    }

    .control-btn{
      background:linear-gradient(145deg,rgba(108,124,255,.98),rgba(11,27,58,.98));
      color:var(--c5);
      border:none;
      padding:12px 26px;border-radius:10px;cursor:pointer;font-size:1.2rem;
      transition:all .3s ease;
      border:1px solid rgba(246,248,255,.45);
      box-shadow:0 10px 22px rgba(11,27,58,.20);
      font-weight:900;
    }
    .control-btn:hover{transform:scale(1.05);box-shadow:0 12px 26px rgba(11,27,58,.24);}
    .control-btn:disabled{
      background:rgba(108,124,255,.35);
      color:rgba(246,248,255,.55);
      cursor:not-allowed;transform:none;box-shadow:none;
      border:1px solid rgba(77,215,250,.14);
    }
    .control-btn-secondary{
      background:linear-gradient(145deg,rgba(77,215,250,.85),rgba(108,124,255,.85));
      color: rgba(246,248,255,.95);
      border:1px solid rgba(246,248,255,.25);
      font-weight:900;
    }

    .console{
      background: rgba(12, 22, 45, .26);
      padding:20px;border-radius:15px;margin-top:30px;min-height:120px;
      font-family:'Courier New', monospace;
      white-space:pre-wrap;overflow-y:auto;max-height:240px;
      border:1px solid rgba(77,215,250,.22);
      color: rgba(246,248,255,.92);
      box-shadow:0 14px 30px rgba(11,27,58,.22);
    }
    .console-title{margin-bottom:10px;font-size:1.2rem;font-weight:900;color: rgba(246,248,255,.95);}

    .move-counter{
      text-align:center;font-size:1.3rem;margin-bottom:15px;
      color: rgba(246,248,255,.95);
      background: rgba(12, 22, 45, .28);
      padding:10px;border-radius:10px;display:inline-block;
      position:relative;left:50%;transform:translateX(-50%);
      border:1px solid rgba(77,215,250,.25);
      font-weight:900;
      box-shadow:0 12px 26px rgba(11,27,58,.25);
    }

    .result-icon{font-size:5rem;margin-bottom:20px;animation:bounce 1s infinite alternate;color:var(--c2);}
    @keyframes bounce{from{transform:translateY(0);}to{transform:translateY(-20px);} }
    .result-title{font-size:2.8rem;margin-bottom:16px;color:var(--c7);font-weight:900;}
    .result-message{
      font-size:1.4rem;line-height:1.6;margin-bottom:24px;
      white-space:pre-line;color:var(--c7);
      padding:15px;background:rgba(255,209,102,.18);
      border-radius:10px;border:1px solid rgba(11,27,58,.10);
      font-weight:800;
    }
    .result-btn{
      background:linear-gradient(145deg,var(--c6),var(--c7));
      color:var(--c5);border:none;padding:15px 40px;border-radius:10px;
      cursor:pointer;font-size:1.2rem;transition:all .3s ease;margin:10px;
      border:1px solid rgba(246,248,255,.45);
      box-shadow:0 10px 22px rgba(11,27,58,.20);
      font-weight:900;
    }
    .result-btn:hover{transform:scale(1.05);box-shadow:0 12px 26px rgba(11,27,58,.24);}
    .result-btn-exit{background:linear-gradient(145deg,var(--c7),var(--c6));}

    @media(max-width:768px){
      h1{font-size:2.5rem;}
      .luotianyi-quote{font-size:1.2rem;}
      .game-selector{flex-direction:column;align-items:center;gap:20px;}
      .game-btn{width:100%;max-width:300px;padding:20px 30px;font-size:1.4rem;}
      .numbers-container{gap:15px;}
      .number-item{width:90px;height:90px;font-size:2.2rem;}
      .rules-modal-content,.result-modal-content{padding:20px;width:95%;}
      .rules-title{font-size:1.8rem;}
      .result-title{font-size:2.2rem;}
      .result-message{font-size:1.2rem;}
    }
  </style>
</head>

<body>
  <div id="snowflakes"></div>

  <!-- è§„åˆ™å¼¹çª— -->
  <div class="rules-modal-overlay" id="rulesModal">
    <div class="rules-modal-content">
      <h2 class="rules-title" id="rulesTitle">æ¸¸æˆè§„åˆ™</h2>
      <div class="rules-text" id="rulesText"></div>
      <div class="rules-countdown" id="rulesCountdown">çª—å£å°†åœ¨15ç§’åè‡ªåŠ¨å…³é—­</div>
      <button class="rules-close-btn" id="rulesCloseBtn">å…³é—­è§„åˆ™è¯´æ˜</button>
    </div>
  </div>

  <!-- ç»“æœå¼¹çª— -->
  <div class="result-modal-overlay" id="resultModal">
    <div class="result-modal-content">
      <div class="result-icon" id="resultIcon">ğŸ‰</div>
      <h2 class="result-title" id="resultTitle">æ¸¸æˆç»“æŸ</h2>
      <div class="result-message" id="resultMessage"></div>
      <div>
        <button class="result-btn" id="resultRestartBtn">é‡æ–°å¼€å§‹</button>
        <button class="result-btn result-btn-exit" id="resultExitBtn">é€€å‡ºæ¸¸æˆ</button>
      </div>
    </div>
  </div>

  <!-- æé†’å¼¹çª—ï¼ˆä¹Ÿç”¨äº 40 å›åˆé€‰æ‹©ï¼‰ -->
  <div class="result-modal-overlay" id="alertModal" style="z-index:1002;">
    <div class="result-modal-content">
      <div class="result-icon" id="alertIcon">âš ï¸</div>
      <h2 class="result-title" id="alertTitle">æé†’</h2>
      <div class="result-message" id="alertMessage"></div>
      <div id="alertBtnRow">
        <button class="result-btn" id="alertOkBtn">çŸ¥é“äº†</button>
      </div>
    </div>
  </div>

  <div class="container">
    <header>
      <h1>My Game</h1>
      <div class="luotianyi-quote">åé£å¤éŸµï¼Œæ´›æ°´å¤©ä¾</div>
    </header>

    <div class="game-selector">
      <button class="game-btn" id="game1Btn">
        <div class="game-icon">ğŸ”¢</div>
        <div>1+1 æ•°å­—æ¸¸æˆ</div>
      </button>
    </div>

    <!-- 1+1 -->
    <div class="game-container" id="game1Container">
      <h2 class="game-title">1+1 æ•°å­—æ¸¸æˆ</h2>
      <div class="move-counter" id="moveCounter1">å›åˆ: 0 | è¿ä¾‹æ¬¡æ•°: 0 | æ‹’ç»æ¬¡æ•°: 0</div>

      <div class="game-area">
        <div class="player-section">
          <h3 class="section-title">ä½ çš„æ•°å­—</h3>
          <div class="numbers-container">
            <div class="number-item" id="playerNum1">1</div>
            <div class="number-item" id="playerNum2">1</div>
          </div>

          <h3 class="section-title">ç”µè„‘çš„æ•°å­—</h3>
          <div class="numbers-container">
            <div class="number-item" id="opponentNum1">1</div>
            <div class="number-item" id="opponentNum2">1</div>
          </div>

          <div class="opbar">
            <button class="control-btn" id="makeMoveBtn" disabled>æ‰§è¡Œæ“ä½œ</button>
          </div>
        </div>

        <div class="console">
          <div class="console-title">æ¸¸æˆæ§åˆ¶å°</div>
          <div id="game1Console">ç­‰å¾…æ¸¸æˆå¼€å§‹...</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== å®Œå…¨æŒ‰ç…§C++åŸç‰ˆæ•°æ®ç»“æ„ ======
    let player = [0, 1, 1];    // player[0]ä¸ä½¿ç”¨ï¼Œplayer[1], player[2]æœ‰æ•ˆ
    let computer = [0, 1, 1];  // computer[0]ä¸ä½¿ç”¨ï¼Œcomputer[1], computer[2]æœ‰æ•ˆ
    let vis = Array.from({length: 10}, () => Array(10).fill(false));
    let ci = 0;
    let cnt = 0;
    let against = 0;
    let jujue = 0;
    
    // ====== å®Œå…¨æŒ‰ç…§C++åŸç‰ˆçš„resè¡¨ ======
    const res = [
      [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
      [-1, 1,   0,   0.5, 0,   0,   1,   1,   0.5, 1  ],
      [-1, 0.5, 1,   1,   0,   1,   0.5, 0,   1,   0  ],
      [-1, 1,   0,   1,   0.5, 0,   0,   1,   1,   0.5],
      [-1, 1,   0.5, 0,   1,   1,   1,   0.5, 0,   0  ],
      [-1, 0,   1,   0,   1,   1,   1,   0,   1,   0  ],
      [-1, 0,   0,   0.5, 1,   1,   1,   0,   0.5, 1  ],
      [-1, 0.5, 1,   1,   0,   0,   0.5, 1,   0,   1  ],
      [-1, 0,   1,   0,   0.5, 1,   0,   1,   1,   0.5],
      [-1, 1,   0.5, 1,   1,   0,   0,   0.5, 0,   1  ]
    ];

    let game1Active = false;
    let pick = {playerIdx: null, oppIdx: null}; // 1-based

    // =========================
    // ===== C++ dfsï¼ˆå®Œæ•´åŸç‰ˆï¼‰=====
    // =========================
    function dfs(cnt, a, b, c, lc) {
      if (c === 0) return 0; // åªæœ‰ä¸€åªæ‰‹çš„ä¸€æ–¹èµ¢

      if ((b === 0 && res[c][a] === 1) || (a === 0 && res[c][b] === 1)) return 0;
      if ((b === 0 && res[c][a] === 0) || (a === 0 && res[c][b] === 0)) return 1;
      if ((b === 0 && res[c][a] === 0.5) || (a === 0 && res[c][b] === 0.5)) return 0.5;

      if (cnt === 25) return 0.5; // æ— æ³•åˆ¤æ–­

      if (lc === 0) {
        // è½®åˆ°åªæœ‰ä¸€åªæ‰‹çš„ä¸€æ–¹
        const ans1 = dfs(cnt + 1, a, b, (c + a) % 10, 1);
        const ans2 = dfs(cnt + 1, a, b, (c + b) % 10, 1);
        if (ans1 === 1 && ans2 === 1) return 1;
        else if (ans1 === 0 || ans2 === 0) return 0;
        else return 0.5;
      } else {
        // è½®åˆ°æœ‰ä¸¤åªæ‰‹çš„ä¸€æ–¹
        const ans1 = dfs(cnt + 1, (c + a) % 10, b, c, 0);
        const ans2 = dfs(cnt + 1, a, (c + b) % 10, c, 0);
        if (ans1 === 0 && ans2 === 0) return 0;
        else if (ans1 === 1 || ans2 === 1) return 1;
        else return 0.5;
      }
    }

    // ==========================================================
    // ===== ç”µè„‘èµ°å­é€»è¾‘ï¼ˆå®Œæ•´C++é€»è¾‘ï¼Œå®Œå…¨æŒ‰ç…§åŸä»£ç ï¼‰=====
    // ==========================================================
    function computerAI() {
      // === åˆ†æ”¯ 1ï¼šåŒæ–¹éƒ½ä¸¤åªæ‰‹ ===
      if (player[1] !== 0 && player[2] !== 0 && computer[1] !== 0 && computer[2] !== 0) {
        let flag = 0;
        const random_number = Math.floor(Math.random() * 2);

        // --- ç¬¬ä¸€æ®µï¼šä¼˜å…ˆæ‰¾ computer[i] + player[j] == 10 ---
        for (let i = 1; i <= 2; i++) {
          for (let j = 2; j >= 1; j--) {
            if (flag) break;
            if (computer[i] + player[j] === 10) {
              const otheri = (i === 1) ? 2 : 1;
              const otherj = (j === 1) ? 2 : 1;
              if (dfs(0, player[j], player[otherj], computer[otheri], 1) < 1) {
                computer[i] = (computer[i] + player[j]) % 10;
                flag = 1;
              } else {
                computer[i] = (computer[i] + player[otherj]) % 10;
                flag = 1;
              }
            }
          }
        }

        // --- ç¬¬äºŒæ®µï¼šrandom æ‰«æç­–ç•¥ï¼ˆå®Œå…¨æŒ‰ç…§C++é€»è¾‘ï¼‰---
        if (!flag) {
          if (random_number) {
            // random_number == 1 çš„æƒ…å†µ
            for (let i = 1; i <= 2; i++) {
              for (let j = 1; j <= 2; j++) {
                if (flag) break;
                const otheri = (i === 1) ? 2 : 1;
                const q = (computer[i] + player[j]) % 10;

                let bo = 0;
                for (let px = 1; px <= 2; px++) {
                  if (player[px] === 0) continue;
                  if (flag) continue;
                  if (player[px] + q === 10) {
                    const opx = (px === 1) ? 2 : 1;
                    if (dfs(0, player[opx], q, computer[otheri], 1) > 0) {
                      computer[i] = q;
                      flag = 1;
                    }
                    bo = 1;
                  }
                }
                if (!bo) {
                  computer[i] = q;
                  flag = 1;
                }
              }
            }
          } else {
            // random_number == 0 çš„æƒ…å†µï¼ˆå®Œå…¨æŒ‰ç…§C++å¤æ‚é€»è¾‘ï¼‰
            for (let i = 2; i >= 1; i--) {
              for (let j = 2; j >= 1; j--) {
                if (flag) break;
                const otheri = (i === 1) ? 2 : 1;
                const q = (computer[i] + player[j]) % 10;
                
                // å®Œå…¨æŒ‰ç…§C++çš„opxæ•°ç»„é€»è¾‘
                const opx = [0, 0, 0]; // opx[0]ä¸ç”¨ï¼Œopx[1]å’Œopx[2]æœ‰æ•ˆ
                let bo = 0;
                
                // æ£€æŸ¥æ˜¯å¦æœ‰player[px] + q == 10
                for (let px = 1; px <= 2; px++) {
                  if (player[px] === 0) continue;
                  if (flag) continue;
                  if (player[px] + q === 10) {
                    opx[px] = (px === 1) ? 2 : 1;
                    bo = 1;
                  }
                }

                if (!bo) {
                  computer[i] = q;
                  flag = 1;
                } else {
                  let nflag = 0;
                  // æ³¨æ„ï¼šè¿™é‡Œå†…å±‚å¾ªç¯å˜é‡ä¹Ÿæ˜¯iï¼Œä¼šè¦†ç›–å¤–å±‚iï¼Œä½†å®Œå…¨æŒ‰ç…§C++åŸä»£ç 
                  for (let i = 1; i <= 2; i++) {
                    if (opx[i]) {
                      if (dfs(0, player[opx[i]], q, computer[otheri], 1) === 0) {
                        nflag = 1;
                        break;
                      }
                    }
                  }
                  if (!nflag) {
                    computer[i] = 1; // å®Œå…¨æŒ‰ç…§C++åŸä»£ç ï¼šcomputer[i] = 1
                    flag = 1;
                  }
                }
              }
            }
          }
        }

        // --- ç¬¬ä¸‰æ®µï¼šé¿å…å˜æˆåŒå€¼ï¼ˆå®Œå…¨æŒ‰ç…§C++é€»è¾‘ï¼‰---
        if (!flag) {
          if (random_number) {
            for (let i = 1; i <= 2; i++) {
              for (let j = 1; j <= 2; j++) {
                if (flag) break;
                const otheri = (i === 1) ? 2 : 1;
                if ((computer[i] + player[j]) % 10 !== computer[otheri]) {
                  computer[i] = (computer[i] + player[j]) % 10;
                  flag = 1;
                }
              }
            }
          } else {
            for (let i = 2; i >= 1; i--) {
              for (let j = 2; j >= 1; j--) {
                if (flag) break;
                const otheri = (i === 1) ? 2 : 1;
                if ((computer[i] + player[j]) % 10 !== computer[otheri]) {
                  computer[i] = (computer[i] + player[j]) % 10;
                  flag = 1;
                }
              }
            }
          }
        }

        // --- å…œåº• ---
        if (!flag) {
          computer[1] = (computer[1] + player[2]) % 10;
        }
        return true;
      }
      // === åˆ†æ”¯ 2ï¼šç©å®¶ä¸€æ‰‹ï¼Œç”µè„‘ä¸¤æ‰‹ ===
      else if ((player[1] === 0 || player[2] === 0) && computer[1] !== 0 && computer[2] !== 0) {
        const x = (player[1] === 0) ? 2 : 1;
        ci = 0;
        if (dfs(0, (computer[1] + player[x]) % 10, computer[2], player[x], 0)) {
          computer[1] = (computer[1] + player[x]) % 10;
        } else {
          computer[2] = (computer[2] + player[x]) % 10;
        }
        return true;
      }
      // === åˆ†æ”¯ 3ï¼šç©å®¶ä¸¤æ‰‹ï¼Œç”µè„‘ä¸€æ‰‹ ===
      else if (player[1] !== 0 && player[2] !== 0 && (computer[1] === 0 || computer[2] === 0)) {
        const Alive = (computer[1] === 0) ? 2 : 1;
        if (dfs(0, player[1], player[2], (computer[Alive] + player[1]) % 10, 1) < 1) {
          computer[Alive] = (computer[Alive] + player[1]) % 10;
        } else {
          computer[Alive] = (computer[Alive] + player[2]) % 10;
        }
        return true;
      }
      // === åˆ†æ”¯ 4ï¼šåŒæ–¹ä¸€æ‰‹ï¼švis åˆ¤å¹³å±€ ===
      else {
        const x = (player[1] === 0) ? 2 : 1;
        const y = (computer[1] === 0) ? 2 : 1;

        if (vis[player[x]][computer[y]]) {
          endGame1Draw("å¹³å±€");
          return false;
        }
        vis[player[x]][computer[y]] = true;

        computer[y] = (computer[y] + player[x]) % 10;

        if (vis[player[x]][computer[y]]) {
          endGame1Draw("å¹³å±€");
          return false;
        }
        vis[player[x]][computer[y]] = true;
        return true;
      }
    }

    // ===== DOM =====
    const game1Btn = document.getElementById('game1Btn');
    const game1Container = document.getElementById('game1Container');
    const makeMoveBtn = document.getElementById('makeMoveBtn');
    const game1Console = document.getElementById('game1Console');
    const moveCounter1 = document.getElementById('moveCounter1');

    const rulesModal = document.getElementById('rulesModal');
    const rulesTitle = document.getElementById('rulesTitle');
    const rulesText = document.getElementById('rulesText');
    const rulesCountdown = document.getElementById('rulesCountdown');
    const rulesCloseBtn = document.getElementById('rulesCloseBtn');

    const resultModal = document.getElementById('resultModal');
    const resultTitle = document.getElementById('resultTitle');
    const resultMessage = document.getElementById('resultMessage');
    const resultIcon = document.getElementById('resultIcon');
    const resultRestartBtn = document.getElementById('resultRestartBtn');
    const resultExitBtn = document.getElementById('resultExitBtn');

    const alertModal = document.getElementById('alertModal');
    const alertTitle = document.getElementById('alertTitle');
    const alertMessage = document.getElementById('alertMessage');
    const alertIcon = document.getElementById('alertIcon');
    const alertBtnRow = document.getElementById('alertBtnRow');

    // ===== é€šç”¨å¼¹çª— =====
    function showAlertModal(title, message, icon = 'âš ï¸') {
      alertIcon.textContent = icon;
      alertTitle.textContent = title;
      alertMessage.textContent = message;

      alertBtnRow.innerHTML = `<button class="result-btn" id="alertOkBtnInner">çŸ¥é“äº†</button>`;
      alertModal.style.display = 'flex';
      document.getElementById('alertOkBtnInner').addEventListener('click', closeAlertModal);
    }

    function showChoiceModal(title, message, icon, buttons) {
      alertIcon.textContent = icon || 'âš ï¸';
      alertTitle.textContent = title;
      alertMessage.textContent = message;

      alertBtnRow.innerHTML = '';
      buttons.forEach(btn => {
        const el = document.createElement('button');
        el.className = 'result-btn' + (btn.secondary ? ' result-btn-exit' : '');
        el.textContent = btn.text;
        el.addEventListener('click', () => {
          closeAlertModal();
          btn.onClick && btn.onClick();
        });
        alertBtnRow.appendChild(el);
      });

      alertModal.style.display = 'flex';
    }

    function closeAlertModal() { alertModal.style.display = 'none'; }
    alertModal.addEventListener('click', (e) => { if (e.target === alertModal) closeAlertModal(); });

    // ===== ç»“æœå¼¹çª— =====
    function showResultModal(type, message) {
      game1Active = false;
      makeMoveBtn.disabled = true;

      if (type === 'win') {
        resultIcon.textContent = 'ğŸ†';
        resultTitle.textContent = 'èƒœåˆ©';
      } else if (type === 'lose') {
        resultIcon.textContent = 'ğŸ’”';
        resultTitle.textContent = 'å¤±è´¥';
      } else {
        resultIcon.textContent = 'ğŸ¤';
        resultTitle.textContent = 'å¹³å±€';
      }

      resultMessage.textContent = message;
      resultModal.style.display = 'flex';
    }

    // ====== å…¥å£æŒ‰é’® ======
    game1Btn.addEventListener('click', () => { 
      showGame('game1'); 
      showRules('game1'); 
    });
    
    rulesCloseBtn.addEventListener('click', closeRules);

    resultRestartBtn.addEventListener('click', () => {
      resultModal.style.display = 'none';
      startGame1();
    });
    
    resultExitBtn.addEventListener('click', () => {
      resultModal.style.display = 'none';
      game1Container.style.display = 'none';
    });

    function showGame(game) {
      game1Container.style.display = 'block';
    }

    // ====== è§„åˆ™ ======
    function showRules(game) {
      rulesTitle.textContent = '1+1 æ¸¸æˆè§„åˆ™';
      rulesText.innerHTML = `
        <p>1. åˆå§‹åŒæ–¹åˆ†åˆ«æœ‰ä¸¤ä¸ªæ•°å­— 1</p>
        <p>2. åŒæ–¹è½®æµæ“ä½œï¼šé€‰æ‹©è‡ªå·±ä»»æ„ä¸€ä¸ªæ•°å­— + å¯¹æ–¹ä»»æ„ä¸€ä¸ªæ•°å­—ï¼Œç„¶åå–ä¸ªä½æ•°</p>
        <p>3. æ•°å­—åœ¨åœºï¼šè¯¥æ•°å­—ä¸ç­‰äº 0</p>
        <p>4. å…ˆè®©è‡ªå·±ä¸¤ä¸ªæ•°å­—å‡ä¸åœ¨åœºï¼ˆéƒ½ä¸º 0ï¼‰çš„ä¸€æ–¹è·èƒœ</p>
        <p>5. è‹¥èµ° 40 ä¸ªå›åˆä»¥ä¸Šä¸åˆ†èƒœè´Ÿï¼Œå¯é€‰æ‹©å’Œæ£‹æˆ–ç»§ç»­</p>
        <p>6. è¿ä¾‹ 2 æ¬¡ç›´æ¥åˆ¤è´Ÿ</p>
      `;
      startGame1();

      rulesModal.style.display = 'flex';
      rulesTimeLeft = 15;
      rulesCountdown.textContent = `çª—å£å°†åœ¨${rulesTimeLeft}ç§’åè‡ªåŠ¨å…³é—­`;
      if (rulesTimer) clearInterval(rulesTimer);
      rulesTimer = setInterval(() => {
        rulesTimeLeft--;
        rulesCountdown.textContent = `çª—å£å°†åœ¨${rulesTimeLeft}ç§’åè‡ªåŠ¨å…³é—­`;
        if (rulesTimeLeft <= 0) closeRules();
      }, 1000);
    }
    
    function closeRules() {
      rulesModal.style.display = 'none';
      if (rulesTimer) { clearInterval(rulesTimer); rulesTimer = null; }
    }

    // =========================
    // ====== 1+1 æ¸¸æˆé€»è¾‘ ======
    // =========================
    function clearPick() {
      pick.playerIdx = null;
      pick.oppIdx = null;
      ['playerNum1', 'playerNum2', 'opponentNum1', 'opponentNum2'].forEach(id => 
        document.getElementById(id).classList.remove('active'));
      makeMoveBtn.disabled = true;
    }

    function updateMakeMoveEnabled() {
      const ok = (pick.playerIdx !== null && pick.oppIdx !== null
        && player[pick.playerIdx] !== 0
        && computer[pick.oppIdx] !== 0);
      makeMoveBtn.disabled = !(ok && game1Active && !game1Active.gameOver);
    }

    function bindGame1Clicks() {
      const p1 = document.getElementById('playerNum1');
      const p2 = document.getElementById('playerNum2');
      const o1 = document.getElementById('opponentNum1');
      const o2 = document.getElementById('opponentNum2');

      function pickPlayer(idx) {
        if (!game1Active) return;
        if (player[idx] === 0) return;
        document.getElementById('playerNum1').classList.toggle('active', idx === 1);
        document.getElementById('playerNum2').classList.toggle('active', idx === 2);
        pick.playerIdx = idx;
        updateMakeMoveEnabled();
      }
      
      function pickOpp(idx) {
        if (!game1Active) return;
        if (computer[idx] === 0) return;
        document.getElementById('opponentNum1').classList.toggle('active', idx === 1);
        document.getElementById('opponentNum2').classList.toggle('active', idx === 2);
        pick.oppIdx = idx;
        updateMakeMoveEnabled();
      }

      p1.addEventListener('click', () => pickPlayer(1));
      p2.addEventListener('click', () => pickPlayer(2));
      o1.addEventListener('click', () => pickOpp(1));
      o2.addEventListener('click', () => pickOpp(2));
    }

    function updateNumberStatus(id, val) {
      const el = document.getElementById(id);
      if (val === 0) el.classList.add('dead');
      else el.classList.remove('dead');
    }

    function updateGame1Display() {
      document.getElementById('playerNum1').textContent = player[1];
      document.getElementById('playerNum2').textContent = player[2];
      document.getElementById('opponentNum1').textContent = computer[1];
      document.getElementById('opponentNum2').textContent = computer[2];

      updateNumberStatus('playerNum1', player[1]);
      updateNumberStatus('playerNum2', player[2]);
      updateNumberStatus('opponentNum1', computer[1]);
      updateNumberStatus('opponentNum2', computer[2]);

      moveCounter1.textContent = `å›åˆ: ${cnt} | è¿ä¾‹æ¬¡æ•°: ${against} | æ‹’ç»æ¬¡æ•°: ${jujue}`;
      updateMakeMoveEnabled();
    }

    function startGame1() {
      // å®Œå…¨æŒ‰ç…§C++åˆå§‹åŒ–
      player = [0, 1, 1];
      computer = [0, 1, 1];
      vis = Array.from({ length: 10 }, () => Array(10).fill(false));
      ci = 0;
      cnt = 0;
      against = 0;
      jujue = 0;
      
      game1Active = true;
      clearPick();
      updateGame1Display();
      game1Console.textContent =
        `æ¸¸æˆå¼€å§‹ï¼
ä½ çš„æ•°å­—ï¼š${player[1]} ${player[2]}
ç”µè„‘çš„æ•°å­—ï¼š${computer[1]} ${computer[2]}
è½®åˆ°ä½ æ“ä½œäº†ï¼`;
    }

    // â€”â€” èƒœè´Ÿåˆ¤å®šï¼ˆå®Œå…¨æŒ‰ç…§C++é€»è¾‘ï¼‰â€”â€”
    function endGame1Win() {
      showResultModal('win', "æˆ‘è¿˜ä¼šå†å›æ¥çš„\næ­å–œä½ ï¼Œå¿«ç‚¹æˆªå±æ‰¾hycé¢†2å—é’±å§");
    }
    
    function endGame1LoseNormal() {
      showResultModal('lose', "å¤§äººï¼Œæ—¶ä»£å˜äº†");
    }
    
    function endGame1LoseViolation() {
      showResultModal('lose', "ä½ è¾“äº†ï¼Œä¸å¬è¯çš„å­©å­è¦å—åˆ°æƒ©ç½š^-^");
    }
    
    function endGame1Draw(msg) {
      showResultModal('draw', msg || "å¹³å±€");
    }

    // 40 å›åˆå¤„ç†ï¼ˆå®Œå…¨æŒ‰ç…§C++é€»è¾‘ï¼‰
    function handleRound40() {
      if (cnt >= 40 && jujue === 0) {
        showChoiceModal(
          "æç¤º",
          "ä¸‹äº†40ä¸ªå›åˆï¼Œæ‚¨ä¸ç´¯å—\nè¾“å‡º 114514 åˆ™ä¸ºå’Œæ£‹ï¼Œè¾“å‡º 1919810 åˆ™ç»§ç»­ä¸‹",
          "âš ï¸",
          [
            { 
              text: "å’Œæ£‹(114514)", 
              onClick: () => { endGame1Draw("å¹³å±€"); } 
            },
            { 
              text: "ç»§ç»­(1919810)", 
              secondary: true, 
              onClick: () => {
                jujue++;
                cnt = 0; // å¯¹åº” C++ cnt=0
                updateGame1Display();
                game1Console.textContent += `\nçœŸæ­£çš„å‹‡å£«å°±æ˜¯åœ¨çœ‹æ¸…æ¸¸æˆçš„çœŸç›¸åï¼Œä»ç„¶çƒ­çˆ±æ¸¸æˆ\nCome on! ç»§ç»­ç©ä¸‹å»å§\n`;
              }
            },
            { 
              text: "è°ƒçš®(å…¶ä»–)", 
              onClick: () => {
                against++;
                game1Console.textContent += `\nè°ƒçš®\nè¿ä¾‹äº†å“¦ï¼Œå†æœ‰ä¸€æ¬¡åˆ¤ä½ è¾“ä¿¡ä¸ä¿¡^-^\n`;
                showAlertModal("è¿ä¾‹æé†’", `è¿ä¾‹æ¬¡æ•°ï¼š${against}/2`, 'âš ï¸');
                if (against >= 2) endGame1LoseViolation();
                updateGame1Display();
              }
            }
          ]
        );
      } else if (cnt >= 40 && jujue > 0) {
        showChoiceModal(
          "æç¤º",
          `åˆä¸‹äº†40ä¸ªå›åˆï¼Œæ‚¨ä¸ç´¯å—\næ‚¨å·²ç»æ‹’ç»${jujue}æ¬¡äº†\næ‚¨ç®€ç›´å°±æ˜¯ä¸€å—ä¼šè¯´è¯çš„é’¢æ¿ï¼\nç»§ç»­ç©ä¸‹å»å§`,
          "âš ï¸",
          [
            { 
              text: "å’Œæ£‹(114514)", 
              onClick: () => { endGame1Draw("å¹³å±€"); } 
            },
            { 
              text: "ç»§ç»­(1919810)", 
              secondary: true, 
              onClick: () => {
                jujue++;
                cnt = 0; // å¯¹åº” C++ cnt=0
                updateGame1Display();
                game1Console.textContent += `\nç»§ç»­ç©ä¸‹å»å§\n`;
              }
            },
            { 
              text: "è°ƒçš®(å…¶ä»–)", 
              onClick: () => {
                against++;
                game1Console.textContent += `\nè°ƒçš®\nè¿ä¾‹äº†å“¦ï¼Œå†æœ‰ä¸€æ¬¡åˆ¤ä½ è¾“ä¿¡ä¸ä¿¡^-^\n`;
                showAlertModal("è¿ä¾‹æé†’", `è¿ä¾‹æ¬¡æ•°ï¼š${against}/2`, 'âš ï¸');
                if (against >= 2) endGame1LoseViolation();
                updateGame1Display();
              }
            }
          ]
        );
      }
    }

    makeMoveBtn.addEventListener('click', () => {
      if (!game1Active) return;

      // æ£€æŸ¥è¿ä¾‹
      if (against === 2) {
        endGame1LoseViolation();
        return;
      }

      // æ£€æŸ¥èƒœè´Ÿ
      if (player[1] === 0 && player[2] === 0) {
        endGame1Win();
        return;
      }
      if (computer[1] === 0 && computer[2] === 0) {
        endGame1LoseNormal();
        return;
      }

      // 40å›åˆå¤„ç†
      if (cnt >= 40) {
        handleRound40();
        return;
      }

      const op1 = pick.playerIdx;
      const op2 = pick.oppIdx;

      // å®Œå…¨æŒ‰ç…§C++çš„è¿ä¾‹æ£€æŸ¥
      if (op1 === null || op2 === null || op1 < 1 || op1 > 2 || op2 < 1 || op2 > 2 ||
          player[op1] === 0 || computer[op2] === 0) {
        against++;
        game1Console.textContent += `\nè¿ä¾‹äº†å“¦ï¼Œå†æœ‰ä¸€æ¬¡åˆ¤ä½ è¾“ä¿¡ä¸ä¿¡^-^\n`;
        showAlertModal('è¿ä¾‹æé†’', `è¿ä¾‹æ¬¡æ•°ï¼š${against}/2`, 'âš ï¸');
        if (against >= 2) {
          endGame1LoseViolation();
          return;
        }
        clearPick();
        updateGame1Display();
        return;
      }

      // ç©å®¶æ“ä½œ
      player[op1] = (computer[op2] + player[op1]) % 10;

      game1Console.textContent += `\n__________________________\n`;
      game1Console.textContent += `${player[1]} ${player[2]}\n${computer[1]} ${computer[2]}\n`;
      game1Console.textContent += `__________________________\n`;

      clearPick();
      updateGame1Display();

      // ç©å®¶æ“ä½œåç«‹å³æ£€æŸ¥
      if (player[1] === 0 && player[2] === 0) {
        endGame1Win();
        return;
      }

      // ç”µè„‘èµ°å­
      setTimeout(() => {
        const ok = computerAI();
        updateGame1Display();

        if (!ok) return; // å¦‚æœcomputerAIè¿”å›falseï¼Œè¯´æ˜å·²ç»ç»“æŸæ¸¸æˆ

        game1Console.textContent += `${player[1]} ${player[2]}\n${computer[1]} ${computer[2]}\n`;
        
        // ç”µè„‘èµ°å®Œåæ£€æŸ¥
        if (computer[1] === 0 && computer[2] === 0) {
          endGame1LoseNormal();
          return;
        }

        game1Console.textContent += `__________________________\n`;

        // å›åˆè®¡æ•°å¢åŠ 
        cnt++;
        updateGame1Display();

        // å†æ¬¡æ£€æŸ¥40å›åˆ
        if (cnt >= 40) {
          handleRound40();
        }
      }, 450);
    });

    // ===== é›ªèŠ± =====
    function createSnowflakes() {
      const snowflakesContainer = document.getElementById('snowflakes');
      for (let i = 0; i < 50; i++) {
        const snowflake = document.createElement('div');
        snowflake.classList.add('snowflake');
        const size = Math.random() * 10 + 5;
        snowflake.style.width = `${size}px`;
        snowflake.style.height = `${size}px`;
        snowflake.style.left = `${Math.random() * 100}vw`;
        snowflake.style.top = `${Math.random() * 100}vh`;
        snowflake.style.opacity = Math.random() * 0.7 + 0.3;
        const duration = Math.random() * 10 + 10;
        const delay = Math.random() * 5;
        snowflake.style.animation = `fall ${duration}s linear ${delay}s infinite`;
        snowflakesContainer.appendChild(snowflake);
      }
    }
    
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fall {
        0% { transform: translateY(-100px) rotate(0deg); }
        100% { transform: translateY(100vh) rotate(360deg); }
      }
    `;
    document.head.appendChild(style);

    function init() {
      game1Container.style.display = 'none';
      createSnowflakes();
      bindGame1Clicks();
      clearPick();
    }
    
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
